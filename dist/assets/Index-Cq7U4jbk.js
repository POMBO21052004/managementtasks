import{r as l,a as f,f as D,j as e,L as M}from"./index-K0TI1Cn5.js";import{A as z}from"./Layout-MqCQlSlI.js";import{C as G}from"./Container-Jb0DCQyA.js";import{R as I,C as c,a as n,B as m}from"./Row-DpO6zsT4.js";import{F as a}from"./Form-CAmGkuOD.js";import{T as ne}from"./Table-fYcqLACk.js";import{B as R}from"./NavBar-BemxVd0Z.js";import{M as x}from"./Modal-D-5iwAgh.js";import{T as he,a as S}from"./ToastContainer-Zqrc0L-G.js";import"./ElementChildren-DHcghUFE.js";function ve(){const[d,_]=l.useState([]),[j,N]=l.useState([]),[b,q]=l.useState(""),[k,H]=l.useState(""),[oe,me]=l.useState(""),[V,P]=l.useState(""),[K,v]=l.useState(!1),[O,w]=l.useState(!1),[y,$]=l.useState(null),[u,E]=l.useState({}),[J,T]=l.useState(!1),[Q,W]=l.useState(""),[C,X]=l.useState("success"),[i,h]=l.useState({username:"",email:"",password:"",password2:"",first_name:"",last_name:"",phone:"",is_admin:!1,is_verified:!1}),[Y,U]=l.useState(!0),[t,F]=l.useState("light");l.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";F(s);const r=new MutationObserver(()=>{const p=document.documentElement.getAttribute("data-theme")||"light";F(p)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]);const o=(s,r="success")=>{W(s),X(r),T(!0)},g=l.useCallback(async()=>{try{U(!0);const s={};b.trim()&&(s.search=b.trim()),k&&(s.created_at=k);const r=await f.get("/auth/admin/users/",{params:s}),p=Array.isArray(r.data)?r.data:r.data.results?r.data.results:r.data.users?r.data.users:[];console.log("Données utilisateurs reçues:",p),_(p)}catch(s){console.error("Erreur lors de la récupération des utilisateurs",s),o("Erreur lors du chargement des utilisateurs","danger"),_([])}finally{U(!1)}},[b,k]);l.useEffect(()=>{D.replace(),g()},[g]),l.useEffect(()=>{D.replace()},[d,j]);const Z=async s=>{s.preventDefault(),E({});try{await f.post("/auth/admin/users/",i),g(),v(!1),h({username:"",email:"",password:"",password2:"",first_name:"",last_name:"",phone:"",is_admin:!1,is_verified:!1}),o("Utilisateur créé avec succès","success")}catch(r){r.response?.status===400?(E(r.response.data||{}),o("Erreur de validation","danger")):(console.error(r),o("Erreur lors de la création","danger"))}},L=(s=null)=>{$(s),w(!0)},ee=async()=>{try{const s=y?[y]:j;if(y)await f.delete(`/auth/admin/users/${y}/`);else for(const r of s)await f.delete(`/auth/admin/users/${r}/`);g(),w(!1),N([]),$(null),o("Utilisateur(s) supprimé(s) avec succès","success")}catch(s){console.error(s),o("Erreur lors de la suppression","danger")}},se=s=>{const{value:r,checked:p}=s.target,B=parseInt(r);N(p?A=>[...A,B]:A=>A.filter(ce=>ce!==B))},te=s=>{s.target.checked?N(d.map(r=>r.id)):N([])},ae=async s=>{try{await f.post(`/auth/admin/users/${s}/toggle_admin/`),g(),o("Statut admin modifié avec succès","success")}catch(r){console.error(r),o(r.response?.data?.error||"Erreur lors de la modification","danger")}},re=async s=>{try{await f.post(`/auth/admin/users/${s}/toggle_verified/`),g(),o("Statut vérification modifié avec succès","success")}catch(r){console.error(r),o("Erreur lors de la modification","danger")}},le=Array.isArray(d)?d.filter(s=>s.is_admin):[],ie=Array.isArray(d)?d.filter(s=>s.is_verified):[],de=Array.isArray(d)?d.filter(s=>!s.is_admin):[];return Y?e.jsx(z,{children:e.jsx(G,{className:"py-4",children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Chargement..."})}),e.jsx("p",{className:"mt-2",children:"Chargement des utilisateurs..."})]})})}):e.jsx(z,{children:e.jsxs(G,{className:"py-4",children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex align-items-center mb-3",children:[e.jsx("div",{className:`me-3 p-3 rounded-circle ${t==="dark"?"bg-primary bg-opacity-25":"bg-primary bg-opacity-10"}`,children:e.jsx("i",{"data-feather":"users",className:"text-primary",style:{width:"24px",height:"24px"}})}),e.jsxs("div",{children:[e.jsx("h2",{className:`mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:"Gestion des Utilisateurs"}),e.jsx("p",{className:`mb-0 ${t==="dark"?"text-light":"text-muted"}`,children:"Administration centrale de tous les utilisateurs du système"})]})]}),e.jsxs(I,{className:"mb-4",children:[e.jsx(c,{md:3,children:e.jsx(n,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(n.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`mb-0 ${t==="dark"?"text-light":"text-dark"}`,children:Array.isArray(d)?d.length:0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Total Utilisateurs"})]}),e.jsx("div",{className:"text-primary",children:e.jsx("i",{"data-feather":"users",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(c,{md:3,children:e.jsx(n,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(n.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-success",children:le.length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Administrateurs"})]}),e.jsx("div",{className:"text-success",children:e.jsx("i",{"data-feather":"shield",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(c,{md:3,children:e.jsx(n,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(n.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-warning",children:ie.length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Vérifiés"})]}),e.jsx("div",{className:"text-warning",children:e.jsx("i",{"data-feather":"check-circle",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(c,{md:3,children:e.jsx(n,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(n.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-info",children:de.length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Utilisateurs Normaux"})]}),e.jsx("div",{className:"text-info",children:e.jsx("i",{"data-feather":"user",style:{width:"24px",height:"24px"}})})]})})})})]})]}),e.jsxs(n,{className:`shadow-sm border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(n.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("div",{className:"d-flex flex-column flex-md-row justify-content-between align-items-center",children:[e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"users",className:"text-primary me-2",style:{width:"20px",height:"20px"}}),e.jsx("span",{className:`fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Liste des Utilisateurs"})]}),e.jsxs("div",{className:"d-flex gap-2 mt-2 mt-md-0",children:[j.length>0&&e.jsxs(m,{variant:"danger",className:"d-flex align-items-center",onClick:()=>L(),children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer (",j.length,")"]}),e.jsxs(m,{variant:"success",className:"d-flex align-items-center",onClick:()=>v(!0),children:[e.jsx("i",{"data-feather":"user-plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Nouvel Utilisateur"]})]})]})}),e.jsxs(n.Body,{className:t==="dark"?"bg-dark":"bg-white",children:[e.jsx("div",{className:"mb-4 p-3 rounded",style:{backgroundColor:t==="dark"?"#1a1a1a":"#f8f9fa"},children:e.jsxs("div",{className:"row g-3",children:[e.jsxs("div",{className:"col-md-4",children:[e.jsxs(a.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"search",className:"me-1",style:{width:"14px",height:"14px"}}),"Recherche Globale"]}),e.jsx(a.Control,{type:"text",placeholder:"Nom, email, téléphone...",value:b,onChange:s=>q(s.target.value),onKeyDown:s=>s.key==="Enter"&&g(),className:t==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs(a.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"calendar",className:"me-1",style:{width:"14px",height:"14px"}}),"Date de création"]}),e.jsx(a.Control,{type:"date",value:k,onChange:s=>H(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs("div",{className:"col-md-3",children:[e.jsxs(a.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"shield",className:"me-1",style:{width:"14px",height:"14px"}}),"Rôle"]}),e.jsxs(a.Select,{value:V,onChange:s=>P(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous les rôles"}),e.jsx("option",{value:"admin",children:"Administrateurs"}),e.jsx("option",{value:"user",children:"Utilisateurs normaux"})]})]}),e.jsxs("div",{className:"col-md-2",children:[e.jsx(a.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(m,{variant:"primary",className:"w-100",onClick:g,children:[e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}}),"Filtrer"]})]})]})}),e.jsx("div",{className:"table-responsive",children:e.jsxs(ne,{hover:!0,className:`align-middle ${t==="dark"?"table-dark":""}`,style:{borderRadius:"8px",overflow:"hidden"},children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{className:"text-center",style:{width:"50px"},children:e.jsx(a.Check,{type:"checkbox",onChange:te,checked:Array.isArray(d)&&j.length===d.length&&d.length>0})}),e.jsxs("th",{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Utilisateur"]}),e.jsxs("th",{className:"d-none d-md-table-cell",children:[e.jsx("i",{"data-feather":"mail",className:"me-2",style:{width:"16px",height:"16px"}}),"Contact"]}),e.jsxs("th",{className:"d-none d-lg-table-cell",children:[e.jsx("i",{"data-feather":"info",className:"me-2",style:{width:"16px",height:"16px"}}),"Informations"]}),e.jsxs("th",{className:"text-center",children:[e.jsx("i",{"data-feather":"shield",className:"me-2",style:{width:"16px",height:"16px"}}),"Statuts"]}),e.jsxs("th",{className:"text-center",children:[e.jsx("i",{"data-feather":"settings",className:"me-2",style:{width:"16px",height:"16px"}}),"Actions"]})]})}),e.jsx("tbody",{children:Array.isArray(d)&&d.length?d.map(s=>e.jsxs("tr",{className:t==="dark"?"border-secondary":"",children:[e.jsx("td",{className:"text-center",children:e.jsx(a.Check,{type:"checkbox",value:s.id,checked:j.includes(s.id),onChange:se})}),e.jsx("td",{children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-2 me-3",children:e.jsx("i",{"data-feather":"user",className:"text-primary",style:{width:"16px",height:"16px"}})}),e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:s.username}),e.jsxs("small",{className:t==="dark"?"text-light":"text-muted",children:[s.first_name," ",s.last_name]})]})]})}),e.jsx("td",{className:"d-none d-md-table-cell",children:e.jsxs("div",{children:[e.jsxs("div",{className:`small ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"mail",className:"me-1",style:{width:"12px",height:"12px"}}),s.email]}),s.phone&&e.jsxs("div",{className:`small ${t==="dark"?"text-light":"text-muted"}`,children:[e.jsx("i",{"data-feather":"phone",className:"me-1",style:{width:"12px",height:"12px"}}),s.phone]})]})}),e.jsx("td",{className:"d-none d-lg-table-cell",children:e.jsxs("div",{children:[e.jsxs("div",{className:`small ${t==="dark"?"text-light":"text-dark"}`,children:["ID: ",s.id]}),e.jsxs("div",{className:`small ${t==="dark"?"text-light":"text-muted"}`,children:["Créé le: ",new Date(s.date_joined).toLocaleDateString("fr-FR")]})]})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex flex-column gap-1 align-items-center",children:[e.jsxs(R,{bg:s.is_admin?"success":"secondary",className:"cursor-pointer",onClick:()=>ae(s.id),title:"Cliquer pour changer le statut admin",children:[e.jsx("i",{"data-feather":s.is_admin?"shield":"user",className:"me-1",style:{width:"12px",height:"12px"}}),s.is_admin?"Admin":"User"]}),e.jsxs(R,{bg:s.is_verified?"warning":"secondary",className:"cursor-pointer",onClick:()=>re(s.id),title:"Cliquer pour changer le statut vérifié",children:[e.jsx("i",{"data-feather":s.is_verified?"check-circle":"x-circle",className:"me-1",style:{width:"12px",height:"12px"}}),s.is_verified?"Vérifié":"Non vérifié"]})]})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex gap-1 justify-content-center",children:[e.jsx(m,{size:"sm",variant:"outline-info",title:"Voir les détails",as:M,to:`/admin/users/${s.id}`,children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})}),e.jsx(m,{size:"sm",variant:"outline-warning",title:"Modifier",as:M,to:`/admin/users/${s.id}/edit`,children:e.jsx("i",{"data-feather":"edit",style:{width:"14px",height:"14px"}})}),e.jsx(m,{size:"sm",variant:"outline-danger",title:"Supprimer",onClick:()=>L(s.id),children:e.jsx("i",{"data-feather":"trash-2",style:{width:"14px",height:"14px"}})})]})})]},s.id)):e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"text-center py-5",children:e.jsxs("div",{className:`${t==="dark"?"text-light":"text-muted"}`,children:[e.jsx("i",{"data-feather":"users",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsxs("div",{children:[e.jsx("h6",{children:"Aucun utilisateur trouvé"}),e.jsx("p",{className:"small mb-0",children:Array.isArray(d)?"Aucun utilisateur ne correspond à vos critères de recherche.":"Erreur lors du chargement des utilisateurs."})]})]})})})})]})})]})]}),e.jsxs(x,{show:K,onHide:()=>v(!1),centered:!0,size:"lg",contentClassName:t==="dark"?"bg-dark text-light":"",children:[e.jsx(x.Header,{className:t==="dark"?"bg-dark text-light border-secondary":"",closeButton:!0,children:e.jsx(x.Title,{children:"Créer un Nouvel Utilisateur"})}),e.jsxs(a,{onSubmit:Z,children:[e.jsx(x.Body,{className:t==="dark"?"bg-dark text-light":"",children:e.jsxs(I,{className:"g-3",children:[e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Nom d'utilisateur *"}),e.jsx(a.Control,{type:"text",placeholder:"Entrez le nom d'utilisateur",required:!0,value:i.username,onChange:s=>h({...i,username:s.target.value}),isInvalid:!!u.username,className:t==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:u.username})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Email *"}),e.jsx(a.Control,{type:"email",placeholder:"Entrez l'adresse email",required:!0,value:i.email,onChange:s=>h({...i,email:s.target.value}),isInvalid:!!u.email,className:t==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:u.email})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Prénom"}),e.jsx(a.Control,{type:"text",placeholder:"Entrez le prénom",value:i.first_name,onChange:s=>h({...i,first_name:s.target.value}),className:t==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Nom"}),e.jsx(a.Control,{type:"text",placeholder:"Entrez le nom",value:i.last_name,onChange:s=>h({...i,last_name:s.target.value}),className:t==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Téléphone"}),e.jsx(a.Control,{type:"tel",placeholder:"Entrez le numéro de téléphone",value:i.phone,onChange:s=>h({...i,phone:s.target.value}),className:t==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Mot de Passe *"}),e.jsx(a.Control,{type:"password",placeholder:"Entrez le mot de passe",required:!0,value:i.password,onChange:s=>h({...i,password:s.target.value}),isInvalid:!!u.password,className:t==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:u.password})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"Confirmer le Mot de Passe *"}),e.jsx(a.Control,{type:"password",placeholder:"Confirmez le mot de passe",required:!0,value:i.password2,onChange:s=>h({...i,password2:s.target.value}),isInvalid:!!u.password2,className:t==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:u.password2})]})}),e.jsx(c,{md:6,children:e.jsxs(a.Group,{children:[e.jsx(a.Check,{type:"checkbox",label:"Administrateur",checked:i.is_admin,onChange:s=>h({...i,is_admin:s.target.checked}),className:t==="dark"?"text-light":""}),e.jsx(a.Check,{type:"checkbox",label:"Vérifié",checked:i.is_verified,onChange:s=>h({...i,is_verified:s.target.checked}),className:t==="dark"?"text-light":""})]})})]})}),e.jsxs(x.Footer,{className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(m,{variant:"secondary",onClick:()=>v(!1),children:"Annuler"}),e.jsxs(m,{type:"submit",variant:"success",children:[e.jsx("i",{"data-feather":"save",className:"me-2",style:{width:"16px",height:"16px"}}),"Créer l'utilisateur"]})]})]})]}),e.jsxs(x,{show:O,onHide:()=>w(!1),centered:!0,contentClassName:t==="dark"?"bg-dark text-light":"",children:[e.jsx(x.Header,{className:t==="dark"?"bg-dark text-light border-secondary":"",closeButton:!0,children:e.jsx(x.Title,{children:"Confirmation de Suppression"})}),e.jsxs(x.Body,{className:t==="dark"?"bg-dark text-light":"",children:[e.jsxs("p",{children:["Êtes-vous sûr de vouloir supprimer ",y?"cet utilisateur":"ces utilisateurs"," ?"]}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2",style:{width:"16px",height:"16px"}}),"Cette action est irréversible."]})]}),e.jsxs(x.Footer,{className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(m,{variant:"secondary",onClick:()=>w(!1),children:"Annuler"}),e.jsxs(m,{variant:"danger",onClick:ee,children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer"]})]})]}),e.jsx(he,{position:"bottom-end",className:"p-3 position-fixed",style:{zIndex:1050},children:e.jsxs(S,{show:J,onClose:()=>T(!1),delay:3e3,autohide:!0,bg:C==="success"?"success":"danger",className:t==="dark"?"text-light":"text-white",children:[e.jsx(S.Header,{closeButton:!1,className:`${C==="success"?"bg-success text-white":"bg-danger text-white"}`,children:e.jsxs("strong",{className:"me-auto",children:[e.jsx("i",{"data-feather":C==="success"?"check-circle":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Notification"]})}),e.jsx(S.Body,{className:t==="dark"?"bg-dark text-light":"",children:Q})]})})]})})}export{ve as default};
