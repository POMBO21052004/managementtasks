import{d as q,u as V,r as d,f as O,j as e,L as p,a as f}from"./index-K0TI1Cn5.js";import{A as C}from"./Layout-MqCQlSlI.js";import{S as J}from"./Spinner-Br6_VxcD.js";import{A as F}from"./Alert-JqR1u8An.js";import{B as j,R as u,C as m,a as o}from"./Row-DpO6zsT4.js";import{F as a}from"./Form-CAmGkuOD.js";import{B as $}from"./NavBar-BemxVd0Z.js";import"./ElementChildren-DHcghUFE.js";function re(){const{id:h}=q(),T=V(),[n,I]=d.useState(null),[b,B]=d.useState([]),[y,G]=d.useState([]),[P,S]=d.useState(!0),[N,_]=d.useState(!1),[g,v]=d.useState(null),[r,k]=d.useState({}),[i,L]=d.useState("light"),[K,A]=d.useState(!0),[Q,D]=d.useState(!0),[c,E]=d.useState({title:"",description:"",priority:"medium",status:"todo",due_date:"",user:"",project:"",is_completed:!1});d.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";L(s);const t=new MutationObserver(()=>{const l=document.documentElement.getAttribute("data-theme")||"light";L(l)});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]);const R=async()=>{try{A(!0);const s=await f.get("/tasks/projects/");B(s.data.results||s.data||[])}catch(s){console.error("Erreur lors du chargement des projets",s)}finally{A(!1)}},M=async()=>{try{D(!0);const s=await f.get("/auth/admin/users/");let t=[];Array.isArray(s.data)?t=s.data:s.data&&Array.isArray(s.data.results)?t=s.data.results:s.data&&Array.isArray(s.data.users)?t=s.data.users:t=[],G(t)}catch(s){console.error("Erreur lors du chargement des utilisateurs",s)}finally{D(!1)}};d.useEffect(()=>{h&&((async()=>{try{S(!0);const l=(await f.get(`/tasks/tasks/${h}`)).data;I(l),E({title:l.title||"",description:l.description||"",priority:l.priority||"medium",status:l.status||"todo",due_date:l.due_date?l.due_date.split("T")[0]:"",user:l.user||"",project:l.project||"",is_completed:l.is_completed||!1})}catch(t){v("Erreur lors du chargement des données"),console.error("Erreur:",t)}finally{S(!1)}})(),R(),M())},[h]),d.useEffect(()=>{O.replace()},[n,b,y]);const x=s=>{const{name:t,value:l,type:U,checked:z}=s.target;E(w=>({...w,[t]:U==="checkbox"?z:l})),r[t]&&k(w=>({...w,[t]:null}))},H=async s=>{s.preventDefault();try{_(!0),v(null),k({});const t={...c,project:c.project||null,status:c.is_completed?"done":c.status};(await f.put(`/tasks/tasks/${h}/`,t)).data&&T(`/admin/tasks/${h}`)}catch(t){t.response?.data?.errors?k(t.response.data.errors):v(t.response?.data?.message||"Erreur lors de la mise à jour")}finally{_(!1)}};return P?e.jsx(C,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(J,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des données..."})]})}):g&&!n?e.jsxs(C,{children:[e.jsxs(F,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),g]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(j,{variant:"secondary",as:p,to:"/admin/tasks",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour à la liste"]})})]}):e.jsxs(C,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(j,{variant:"outline-secondary",size:"sm",as:p,to:`/admin/tasks/${h}`,className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsx("h1",{className:"h3 mb-0",children:"Modifier la tâche"})]}),e.jsxs("p",{className:"text-muted mb-0",children:["Modification de la tâche : ",n?.title]})]})}),g&&e.jsxs(F,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),g]}),e.jsx(a,{onSubmit:H,children:e.jsxs(u,{children:[e.jsx(m,{lg:8,className:"mb-4",children:e.jsxs(o,{className:`border-0 shadow-sm ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations de la tâche"]})}),e.jsxs(o.Body,{children:[e.jsx(u,{children:e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Assigner à *",e.jsxs($,{bg:"info",className:"ms-2",children:[y.length," utilisateur(s)"]})]}),e.jsxs(a.Select,{name:"user",value:c.user,onChange:x,isInvalid:!!r.user,className:i==="dark"?"bg-dark text-light border-secondary":"",required:!0,children:[e.jsx("option",{value:"",children:"Sélectionner un utilisateur..."}),y.map(s=>e.jsxs("option",{value:s.id,children:[s.username," - ",s.email]},s.id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.user?.[0]})]})})}),e.jsx(u,{children:e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Projet (optionnel)",e.jsxs($,{bg:"primary",className:"ms-2",children:[b.length," projet(s)"]})]}),e.jsxs(a.Select,{name:"project",value:c.project,onChange:x,isInvalid:!!r.project,className:i==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Aucun projet (tâche indépendante)"}),b.map(s=>e.jsxs("option",{value:s.id,children:[s.title,s.status!=="active"&&` [${s.status}]`]},s.id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.project?.[0]})]})})}),e.jsx("hr",{className:"my-3"}),e.jsxs(u,{children:[e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"type",className:"me-2",style:{width:"16px",height:"16px"}}),"Titre de la tâche *"]}),e.jsx(a.Control,{type:"text",name:"title",value:c.title,onChange:x,placeholder:"Titre de la tâche",isInvalid:!!r.title,className:i==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.title?.[0]})]})}),e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"16px",height:"16px"}}),"Description"]}),e.jsx(a.Control,{as:"textarea",rows:4,name:"description",value:c.description,onChange:x,placeholder:"Description détaillée de la tâche...",isInvalid:!!r.description,className:i==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.description?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"16px",height:"16px"}}),"Priorité"]}),e.jsxs(a.Select,{name:"priority",value:c.priority,onChange:x,isInvalid:!!r.priority,className:i==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"low",children:"Basse"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"high",children:"Haute"})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.priority?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"activity",className:"me-2",style:{width:"16px",height:"16px"}}),"Statut"]}),e.jsxs(a.Select,{name:"status",value:c.status,onChange:x,isInvalid:!!r.status,className:i==="dark"?"bg-dark text-light border-secondary":"",disabled:c.is_completed,children:[e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.status?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"calendar",className:"me-2",style:{width:"16px",height:"16px"}}),"Date d'échéance"]}),e.jsx(a.Control,{type:"date",name:"due_date",value:c.due_date,onChange:x,isInvalid:!!r.due_date,className:i==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:r.due_date?.[0]})]})}),e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsx(a.Label,{children:"État d'achèvement"}),e.jsxs("div",{children:[e.jsx(a.Check,{type:"checkbox",name:"is_completed",label:"Tâche terminée",checked:c.is_completed,onChange:x,className:i==="dark"?"text-light":""}),e.jsx(a.Text,{className:"text-muted",children:"Cochez cette case si la tâche est complétée"})]})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(u,{children:e.jsx(m,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(j,{variant:"outline-secondary",as:p,to:`/admin/tasks/${h}`,className:"me-2",disabled:N,children:"Annuler"}),e.jsx(j,{variant:"primary",type:"submit",disabled:N,className:"d-flex align-items-center",children:N?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Mise à jour..."]}):e.jsx(e.Fragment,{children:"Enregistrer les Modifications"})})]})})})]})]})}),e.jsxs(m,{lg:4,children:[n&&e.jsxs(o,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${i==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-success",style:{width:"20px",height:"20px"}}),"Informations actuelles"]})}),e.jsxs(o.Body,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Assignée à"}),e.jsx("span",{className:"small fw-bold",children:n.user_name||n.user_email})]}),n.project_title&&e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Projet"}),e.jsx("span",{className:"small fw-bold",children:n.project_title})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Créée le"}),e.jsx("span",{className:"small",children:new Date(n.created_at).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Dernière modification"}),e.jsx("span",{className:"small",children:new Date(n.updated_at).toLocaleDateString("fr-FR")})]}),n.completed_at&&e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("span",{className:"small",children:"Terminée le"}),e.jsx("span",{className:"small",children:new Date(n.completed_at).toLocaleDateString("fr-FR")})]})]})]}),e.jsxs(o,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${i==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"help-circle",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"Conseils"]})}),e.jsx(o.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les projets aident à organiser les tâches par contexte"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"flag",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Utilisez les priorités pour organiser le travail"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"calendar",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les dates d'échéance aident à suivre les délais"})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"check-circle",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Marquez comme terminée pour suivre la progression"})]})]})})]}),e.jsxs(o,{className:`border-0 shadow-sm ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${i==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"settings",className:"me-2 text-warning",style:{width:"20px",height:"20px"}}),"Actions supplémentaires"]})}),e.jsx(o.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(j,{variant:"outline-info",as:p,to:`/admin/tasks/${h}`,children:[e.jsx("i",{"data-feather":"eye",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir la tâche"]}),n?.project&&e.jsxs(j,{variant:"outline-primary",as:p,to:`/admin/projects/${n.project}/tasks`,children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir le projet"]}),e.jsxs(j,{variant:"outline-secondary",as:p,to:"/admin/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes les tâches"]})]})})]})]})]})})]})}export{re as default};
