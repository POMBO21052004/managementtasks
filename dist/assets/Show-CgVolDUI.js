import{d as O,u as U,r as l,f as V,j as e,L as m,a as x}from"./index-hRRtG8yy.js";import{A as b}from"./Layout-DZHbYMkx.js";import{S as G}from"./Spinner-CLl_Ort6.js";import{A as J}from"./Alert-CoKbwLKe.js";import{B as r,R as g,C as c,a as t}from"./Row-bX7h-1jy.js";import{B as j}from"./NavBar-mvMqGCSV.js";import{M as u}from"./Modal-BDWqgiwM.js";import{T as K,a as w}from"./ToastContainer-DioU2tZb.js";function te(){const{id:n}=O(),D=U(),[s,f]=l.useState(null),[A,v]=l.useState(!0),[k,H]=l.useState(null),[i,T]=l.useState("light"),[q,_]=l.useState(!1),[L,R]=l.useState(""),[N,z]=l.useState("success"),[I,p]=l.useState(!1);l.useEffect(()=>{const a=document.documentElement.getAttribute("data-theme")||"light";T(a);const d=new MutationObserver(()=>{const F=document.documentElement.getAttribute("data-theme")||"light";T(F)});return d.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>d.disconnect()},[]);const h=(a,d="success")=>{R(a),z(d),_(!0)};l.useEffect(()=>{n&&(async()=>{try{v(!0);const d=await x.get(`/tasks/tasks/${n}/`);f(d.data)}catch(d){H("Erreur lors du chargement de la tâche"),console.error("Erreur:",d)}finally{v(!1)}})()},[n]),l.useEffect(()=>{V.replace()},[s]);const P=async()=>{try{await x.delete(`/tasks/tasks/${n}/`),h("Tâche supprimée avec succès","success"),setTimeout(()=>{D("/admin/tasks")},1500)}catch(a){console.error(a),h("Erreur lors de la suppression","danger")}p(!1)},S=async()=>{try{await x.post(`/tasks/tasks/${n}/mark_completed/`);const a=await x.get(`/tasks/tasks/${n}/`);f(a.data),h("Tâche marquée comme terminée","success")}catch(a){console.error(a),h("Erreur lors de la modification","danger")}},$=async()=>{try{await x.post(`/tasks/tasks/${n}/mark_incomplete/`);const a=await x.get(`/tasks/tasks/${n}/`);f(a.data),h("Tâche marquée comme non terminée","success")}catch(a){console.error(a),h("Erreur lors de la modification","danger")}},C=a=>({high:"danger",medium:"warning",low:"success"})[a]||"secondary",M=a=>({done:"success",in_progress:"primary",todo:"secondary"})[a]||"secondary",B=a=>({high:"Haute",medium:"Moyenne",low:"Basse"})[a]||a,E=a=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[a]||a,o=a=>a?new Date(a).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Non définie",y=a=>a?new Date(a)<new Date&&s?.status!=="done":!1;return A?e.jsx(b,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(G,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des informations de la tâche..."})]})}):k||!s?e.jsxs(b,{children:[e.jsxs(J,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),k||"Tâche introuvable"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(r,{variant:"secondary",as:m,to:"/admin/tasks",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour à la liste"]})})]}):e.jsxs(b,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(r,{variant:"outline-secondary",size:"sm",as:m,to:"/admin/tasks",className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-0 ${i==="dark"?"text-light":"text-dark"}`,children:s.title}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsxs(j,{bg:C(s.priority),className:"px-2 py-1",children:[e.jsx("i",{"data-feather":"flag",className:"me-1",style:{width:"12px",height:"12px"}}),B(s.priority)]}),e.jsxs(j,{bg:M(s.status),className:"px-2 py-1",children:[e.jsx("i",{"data-feather":s.status==="done"?"check-circle":"clock",className:"me-1",style:{width:"12px",height:"12px"}}),E(s.status)]}),y(s.due_date)&&e.jsxs(j,{bg:"danger",className:"px-2 py-1",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-1",style:{width:"12px",height:"12px"}}),"En retard"]})]})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[s.status!=="done"?e.jsxs(r,{variant:"success",onClick:S,children:[e.jsx("i",{"data-feather":"check-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer Terminée"]}):e.jsxs(r,{variant:"warning",onClick:$,children:[e.jsx("i",{"data-feather":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer Non Terminée"]}),e.jsxs(r,{variant:"primary",as:m,to:`/admin/tasks/${n}/edit`,children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"16px",height:"16px"}}),"Modifier"]}),e.jsxs(r,{variant:"danger",onClick:()=>p(!0),children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer"]})]})]}),e.jsxs(g,{children:[e.jsx(c,{lg:8,children:e.jsxs(t,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(t.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"20px",height:"20px"}}),"Détails de la tâche"]})}),e.jsxs(t.Body,{children:[e.jsx(g,{className:"mb-4",children:e.jsxs(c,{md:12,children:[e.jsx("h4",{className:"mb-3",children:s.title}),s.description?e.jsx("div",{className:`p-3 rounded ${i==="dark"?"bg-dark border":"bg-light"}`,children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:s.description})}):e.jsx("p",{className:"text-muted fst-italic",children:"Aucune description fournie"})]})}),e.jsx("hr",{className:"my-4"}),e.jsxs(g,{children:[e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Statut :"}),e.jsx(j,{bg:M(s.status),children:E(s.status)})]})}),e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Priorité :"}),e.jsx(j,{bg:C(s.priority),children:B(s.priority)})]})}),e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Échéance :"}),e.jsxs("span",{className:`fw-medium ${y(s.due_date)?"text-danger":""}`,children:[s.due_date?o(s.due_date):"Non définie",y(s.due_date)&&e.jsx("i",{"data-feather":"alert-triangle",className:"ms-1",style:{width:"14px",height:"14px"}})]})]})}),e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Terminée :"}),e.jsx(j,{bg:s.is_completed?"success":"secondary",children:s.is_completed?"Oui":"Non"})]})}),s.completed_at&&e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Terminée le :"}),e.jsx("span",{className:"fw-medium",children:o(s.completed_at)})]})}),e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Créée le :"}),e.jsx("span",{className:"fw-medium",children:o(s.created_at)})]})}),e.jsx(c,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Dernière modification :"}),e.jsx("span",{className:"fw-medium",children:o(s.updated_at)})]})})]})]})]})}),e.jsx(c,{lg:4,children:e.jsxs(t,{className:`border-0 shadow-sm ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(t.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-secondary",style:{width:"20px",height:"20px"}}),"Informations système"]})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"hash",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"ID Tâche"}),e.jsx("div",{className:"text-muted",children:s.id})]})]}),e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"calendar",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Date de création"}),e.jsx("div",{className:"text-muted",children:o(s.created_at)})]})]}),e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"clock",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Dernière modification"}),e.jsx("div",{className:"text-muted",children:o(s.updated_at)})]})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"user",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"ID Utilisateur"}),e.jsx("div",{className:"text-muted",children:s.user})]})]})]})})]})}),e.jsxs(g,{children:[e.jsx(c,{md:4,className:"mb-3",children:s.project&&e.jsxs(t,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(t.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"20px",height:"20px"}}),"Projet associé"]})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3",children:e.jsx("i",{"data-feather":"folder",className:"text-primary",style:{width:"32px",height:"32px"}})}),e.jsx("h6",{className:"mb-1",children:s.project_title}),e.jsxs(r,{variant:"outline-primary",size:"sm",as:m,to:`/admin/projects/${s.project}/tasks`,className:"mt-2",children:[e.jsx("i",{"data-feather":"list",className:"me-1",style:{width:"14px",height:"14px"}}),"Voir toutes les tâches du projet"]})]})})]})}),e.jsx(c,{md:4,className:"mb-3",children:e.jsxs(t,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(t.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"20px",height:"20px"}}),"Assignée à"]})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3",children:e.jsx("i",{"data-feather":"user",className:"text-primary",style:{width:"32px",height:"32px"}})}),e.jsx("h6",{className:"mb-1",children:s.user_name||s.user_email}),e.jsx("p",{className:"text-muted mb-2",children:s.user_email}),e.jsxs(r,{variant:"outline-primary",size:"sm",as:m,to:`/admin/users/${s.user}`,children:[e.jsx("i",{"data-feather":"eye",className:"me-1",style:{width:"14px",height:"14px"}}),"Voir le profil"]})]})})]})}),e.jsx(c,{md:4,className:"mb-3",children:e.jsxs(t,{className:`border-0 shadow-sm mb-4 ${i==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(t.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"zap",className:"me-2",style:{width:"20px",height:"20px"}}),"Actions rapides"]})}),e.jsx(t.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[s.status!=="done"?e.jsxs(r,{variant:"success",onClick:S,children:[e.jsx("i",{"data-feather":"check-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer comme terminée"]}):e.jsxs(r,{variant:"warning",onClick:$,children:[e.jsx("i",{"data-feather":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer comme non terminée"]}),e.jsxs(r,{variant:"primary",as:m,to:`/admin/tasks/${n}/edit`,children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"16px",height:"16px"}}),"Modifier la tâche"]}),e.jsxs(r,{variant:"outline-info",as:m,to:"/admin/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes les tâches"]})]})})]})})]})]}),e.jsxs(u,{show:I,onHide:()=>p(!1),centered:!0,contentClassName:i==="dark"?"bg-dark text-light":"",children:[e.jsx(u.Header,{className:i==="dark"?"bg-dark text-light border-secondary":"",closeButton:!0,children:e.jsx(u.Title,{children:"Confirmation de Suppression"})}),e.jsxs(u.Body,{className:i==="dark"?"bg-dark text-light":"",children:[e.jsx("p",{children:"Êtes-vous sûr de vouloir supprimer cette tâche ?"}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2",style:{width:"16px",height:"16px"}}),'Cette action est irréversible. La tâche "',s.title,'" sera définitivement supprimée.']}),e.jsxs("div",{className:"alert alert-info",children:[e.jsx("i",{"data-feather":"info",className:"me-2",style:{width:"16px",height:"16px"}}),e.jsx("strong",{children:"Utilisateur :"})," ",s.user_name||s.user_email]})]}),e.jsxs(u.Footer,{className:i==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(r,{variant:"secondary",onClick:()=>p(!1),children:"Annuler"}),e.jsxs(r,{variant:"danger",onClick:P,children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer définitivement"]})]})]}),e.jsx(K,{position:"bottom-end",className:"p-3 position-fixed",style:{zIndex:1050},children:e.jsxs(w,{show:q,onClose:()=>_(!1),delay:3e3,autohide:!0,bg:N==="success"?"success":"danger",className:i==="dark"?"text-light":"text-white",children:[e.jsx(w.Header,{closeButton:!1,className:`${N==="success"?"bg-success text-white":"bg-danger text-white"}`,children:e.jsxs("strong",{className:"me-auto",children:[e.jsx("i",{"data-feather":N==="success"?"check-circle":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Notification"]})}),e.jsx(w.Body,{className:i==="dark"?"bg-dark text-light":"",children:L})]})})]})}export{te as default};
