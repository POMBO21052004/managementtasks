import{d as M,r as l,a as P,f as S,j as e,L as g}from"./index-hRRtG8yy.js";import{A as f}from"./Layout-Js2Zl1pA.js";import{B as d,a as c,R as z,C as u}from"./Row-bX7h-1jy.js";import{B as h}from"./NavBar-mvMqGCSV.js";import{P as D}from"./ProgressBar-Dqb3uvNn.js";import{F as i}from"./Form-Dsmz1YOZ.js";import{T as H}from"./Table-qWWWCHOI.js";import"./ElementChildren-NDIL728O.js";function U(){const{id:p}=M(),[o,E]=l.useState(null),[r,B]=l.useState([]),[v,y]=l.useState(!0),[t,w]=l.useState("light"),[m,k]=l.useState(""),[x,T]=l.useState(""),[j,$]=l.useState("");l.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";w(s);const a=new MutationObserver(()=>{const b=document.documentElement.getAttribute("data-theme")||"light";w(b)});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>a.disconnect()},[]);const N=l.useCallback(async()=>{try{y(!0);const s=await P.get(`/tasks/projects/${p}/`);E(s.data);const a={};m&&(a.search=m),x&&(a.priority=x),j&&(a.status=j);const b=await P.get(`/tasks/projects/${p}/my_tasks/`,{params:a});B(b.data||[])}catch(s){console.error("Erreur lors du chargement des données",s)}finally{y(!1)}},[p,m,x,j]);l.useEffect(()=>{S.replace(),N()},[N]),l.useEffect(()=>{S.replace()},[r,o]);const L=s=>({high:"danger",medium:"warning",low:"success"})[s]||"secondary",R=s=>({done:"success",in_progress:"primary",todo:"secondary"})[s]||"secondary",F=s=>({high:"Haute",medium:"Moyenne",low:"Basse"})[s]||s,_=s=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[s]||s,C=s=>s?new Date(s).toLocaleDateString("fr-FR"):"Non définie",A=(s,a)=>!s||a==="done"?!1:new Date(s)<new Date,n=()=>{if(!r.length)return 0;const s=r.filter(a=>a.status==="done").length;return Math.round(s/r.length*100)};return v?e.jsx(f,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Chargement..."})}),e.jsx("p",{className:"mt-2",children:"Chargement des tâches du projet..."})]})}):o?e.jsx(f,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(d,{variant:"outline-secondary",size:"sm",as:g,to:"/employee/projects",className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Mes Projets"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:`h3 mb-0 ${t==="dark"?"text-light":"text-dark"}`,children:[o.title," - Mes Tâches"]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsxs(h,{bg:"info",className:"px-2 py-1",children:[r.length," tâche(s)"]}),e.jsxs(h,{bg:"success",className:"px-2 py-1",children:[n(),"% terminé"]})]})]})]}),o.description&&e.jsx("p",{className:`mb-0 ${t==="dark"?"text-light":"text-muted"}`,children:o.description})]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(d,{variant:"outline-primary",as:g,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes mes tâches"]})})]}),e.jsx(c,{className:`border-0 shadow-sm mb-4 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(c.Body,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-3",children:[e.jsx("h6",{className:"mb-0",children:"Progression de mes tâches dans ce projet"}),e.jsxs(h,{bg:n()>=80?"success":n()>=50?"warning":"danger",children:[n(),"%"]})]}),e.jsx(D,{now:n(),variant:n()>=80?"success":n()>=50?"warning":"danger",style:{height:"10px"}}),e.jsxs("div",{className:"row text-center mt-3",children:[e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"border-end border-secondary",children:[e.jsx("div",{className:`h5 mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:r.length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Total"})]})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"border-end border-secondary",children:[e.jsx("div",{className:"h5 mb-1 text-success",children:r.filter(s=>s.status==="done").length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Terminées"})]})}),e.jsx("div",{className:"col-md-3",children:e.jsxs("div",{className:"border-end border-secondary",children:[e.jsx("div",{className:"h5 mb-1 text-primary",children:r.filter(s=>s.status==="in_progress").length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"En Cours"})]})}),e.jsxs("div",{className:"col-md-3",children:[e.jsx("div",{className:"h5 mb-1 text-warning",children:r.filter(s=>s.status==="todo").length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"À Faire"})]})]})]})}),e.jsx(c,{className:`border-0 shadow-sm mb-4 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(c.Body,{children:e.jsxs(z,{className:"g-3",children:[e.jsxs(u,{md:4,children:[e.jsx(i.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Recherche"}),e.jsx(i.Control,{type:"text",placeholder:"Rechercher par titre ou description...",value:m,onChange:s=>k(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs(u,{md:3,children:[e.jsx(i.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Priorité"}),e.jsxs(i.Select,{value:x,onChange:s=>T(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Toutes"}),e.jsx("option",{value:"high",children:"Haute"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"low",children:"Basse"})]})]}),e.jsxs(u,{md:3,children:[e.jsx(i.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Statut"}),e.jsxs(i.Select,{value:j,onChange:s=>$(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]})]}),e.jsxs(u,{md:1,children:[e.jsx(i.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"primary",className:"w-100",onClick:N,children:[e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}}),"Filtrer"]})]}),e.jsxs(u,{md:1,children:[e.jsx(i.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"outline-secondary",className:"w-100",onClick:()=>{k(""),T(""),$("")},children:[e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}}),"Réinitialiser"]})]})]})})}),e.jsxs(c,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(c.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"20px",height:"20px"}}),"Mes Tâches dans ce Projet (",r.length,")"]})})}),e.jsxs(c.Body,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{hover:!0,className:`align-middle ${t==="dark"?"table-dark":""}`,children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tâche"}),e.jsx("th",{className:"text-center",children:"Priorité"}),e.jsx("th",{className:"text-center",children:"Statut"}),e.jsx("th",{children:"Échéance"}),e.jsx("th",{className:"text-center",children:"Créée le"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:r.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:s.title}),s.description&&e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:s.description.length>100?`${s.description.substring(0,100)}...`:s.description}),A(s.due_date,s.status)&&e.jsx("div",{children:e.jsxs(h,{bg:"danger",className:"mt-1",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-1",style:{width:"10px",height:"10px"}}),"En retard"]})})]})}),e.jsx("td",{className:"text-center",children:e.jsx(h,{bg:L(s.priority),children:F(s.priority)})}),e.jsx("td",{className:"text-center",children:e.jsx(h,{bg:R(s.status),children:_(s.status)})}),e.jsx("td",{children:e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:C(s.due_date)})}),e.jsx("td",{className:"text-center",children:e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:C(s.created_at)})}),e.jsx("td",{className:"text-center",children:e.jsx(d,{size:"sm",variant:"outline-info",as:g,to:`/employee/tasks/${s.id}`,title:"Voir les détails",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})})})]},s.id))})]})}),r.length===0&&!v&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"check-square",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsx("h6",{className:t==="dark"?"text-light":"text-dark",children:"Aucune tâche trouvée"}),e.jsx("p",{className:t==="dark"?"text-light":"text-muted",children:m||x||j?"Aucune tâche ne correspond à vos critères de recherche dans ce projet.":"Vous n'avez pas de tâches dans ce projet pour le moment."})]})]})]})]})}):e.jsx(f,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"text-warning mb-3",style:{width:"48px",height:"48px"}}),e.jsx("h5",{children:"Projet non trouvé"}),e.jsx("p",{className:"text-muted",children:"Le projet que vous recherchez n'existe pas ou vous n'y avez pas accès."}),e.jsxs(d,{variant:"primary",as:g,to:"/employee/projects",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Retour à mes projets"]})]})})}export{U as default};
