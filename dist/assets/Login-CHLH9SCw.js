import{r as d,b as z,u as B,f as I,j as e,a as w}from"./index-hRRtG8yy.js";import{C as O}from"./Container-BYekCvJV.js";import{R,C as V,a as b,B as h}from"./Row-bX7h-1jy.js";import{A as G}from"./Alert-CoKbwLKe.js";import{F as a}from"./Form-Dsmz1YOZ.js";import{S as $}from"./Spinner-CLl_Ort6.js";import"./ElementChildren-NDIL728O.js";const Q=()=>{const[x,v]=d.useState(1),[n,S]=d.useState({email:"",password:"",otp_code:""}),[f,o]=d.useState(null),[l,p]=d.useState({}),[u,g]=d.useState(!1),[c,m]=d.useState(null),[j,F]=d.useState(!1),{login:E}=z(),k=B(),[t,y]=d.useState(localStorage.getItem("theme")||"light");d.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";y(s);const r=new MutationObserver(()=>{const i=document.documentElement.getAttribute("data-theme")||"light";y(i)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]),d.useEffect(()=>{I.replace()},[t,f,u,x]);const N=s=>{S({...n,[s.target.name]:s.target.value}),p({...l,[s.target.name]:null}),o(null)},_=async s=>{s.preventDefault(),o(null),p({}),g(!0);try{const r=await w.post("/auth/login",n);v(2)}catch(r){const i=r.response;i?.status===422&&i.data?.errors?p(i.data.errors):o(i?.data?.message||"Erreur de connexion")}finally{g(!1)}},A=async s=>{s.preventDefault(),o(null),p({}),g(!0);try{const r=await w.post("/auth/verify-otp",{email:n.email,otp_code:n.otp_code}),{token:i,user:C,tokens:L}=r.data;E(C,L.access),C.is_admin?k("/admin/dashboard"):k("/employe/dashboard")}catch(r){const i=r.response;i?.status===422&&i.data?.errors?p(i.data.errors):o(i?.data?.message||"Code OTP invalide")}finally{g(!1)}},T=async()=>{try{await w.post("/auth/resend-otp",{email:n.email}),o(null)}catch{o("Erreur lors de l'envoi du code OTP")}},P=()=>{const s=document.documentElement,r=s.getAttribute("data-theme")==="dark"?"light":"dark";s.setAttribute("data-theme",r),localStorage.setItem("theme",r),y(r)};return e.jsx("div",{className:`min-vh-100 d-flex align-items-center py-4 ${t==="dark"?"bg-dark":"bg-light"}`,style:{background:t==="dark"?"linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%)":"linear-gradient(135deg, #e3f2fd 0%, #f8f9fa 50%, #e8f5e8 100%)"},children:e.jsx(O,{children:e.jsx(R,{className:"justify-content-center",children:e.jsxs(V,{xl:5,lg:6,md:8,sm:10,children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h1",{className:`h3 fw-bold mb-2 ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"check-circle",className:"text-primary me-2",style:{width:"24px",height:"24px"}}),"Task Manager"]}),e.jsx("p",{className:`mb-0 ${t==="dark"?"text-light":"text-muted"}`,children:"Gérez vos tâches efficacement"}),e.jsx("div",{className:"d-flex justify-content-center align-items-center mt-2",children:e.jsxs("div",{className:"badge bg-primary bg-opacity-10 text-primary px-3 py-1 rounded-pill",children:[e.jsx("i",{"data-feather":"shield",className:"me-1",style:{width:"14px",height:"14px"}}),"Authentification sécurisée"]})})]}),e.jsxs(b,{className:`shadow-lg border-0 overflow-hidden ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx("div",{className:"bg-primary",style:{height:"4px"}}),e.jsx(b.Header,{className:`text-center py-4 border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h4",{className:`mb-1 fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:x===1?"Connexion":"Vérification OTP"}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:x===1?"Accédez à votre espace":"Entrez le code de vérification"})]}),e.jsx(h,{variant:t==="dark"?"outline-light":"outline-secondary",size:"sm",onClick:P,className:"rounded-circle p-2",style:{width:"40px",height:"40px"},children:e.jsx("i",{"data-feather":t==="dark"?"sun":"moon",style:{width:"16px",height:"16px"}})})]})}),e.jsxs(b.Body,{className:`p-4 ${t==="dark"?"bg-dark":"bg-white"}`,children:[f&&e.jsxs(G,{variant:"danger",className:"d-flex align-items-start mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"text-danger me-2 mt-1",style:{width:"18px",height:"18px"}}),e.jsxs("div",{children:[e.jsx("strong",{children:"Erreur"}),e.jsx("div",{className:"small mt-1",children:f})]})]}),x===1&&e.jsxs(a,{onSubmit:_,className:"needs-validation",noValidate:!0,children:[e.jsxs(a.Group,{className:"mb-4",children:[e.jsxs(a.Label,{className:`fw-semibold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"mail",className:"me-2",style:{width:"16px",height:"16px"}}),"Adresse email"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(a.Control,{type:"email",name:"email",placeholder:"votre@email.com",value:n.email,onChange:N,onFocus:()=>m("email"),onBlur:()=>m(null),isInvalid:!!l.email,className:`py-3 ps-5 ${t==="dark"?"bg-dark text-light border-secondary":"bg-light"} ${c==="email"?"border-primary shadow-sm":""}`,required:!0}),e.jsx("div",{className:"position-absolute top-50 start-0 translate-middle-y ps-3",children:e.jsx("i",{"data-feather":"user",className:`${c==="email"?"text-primary":t==="dark"?"text-light":"text-muted"}`,style:{width:"18px",height:"18px"}})})]}),l.email&&e.jsxs(a.Control.Feedback,{type:"invalid",className:"d-block",children:[e.jsx("i",{"data-feather":"x-circle",className:"me-1",style:{width:"14px",height:"14px"}}),l.email]})]}),e.jsxs(a.Group,{className:"mb-4",children:[e.jsxs(a.Label,{className:`fw-semibold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"lock",className:"me-2",style:{width:"16px",height:"16px"}}),"Mot de passe"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(a.Control,{type:j?"text":"password",name:"password",placeholder:"••••••••",value:n.password,onChange:N,onFocus:()=>m("password"),onBlur:()=>m(null),isInvalid:!!l.password,className:`py-3 ps-5 pe-5 ${t==="dark"?"bg-dark text-light border-secondary":"bg-light"} ${c==="password"?"border-primary shadow-sm":""}`,required:!0}),e.jsx("div",{className:"position-absolute top-50 start-0 translate-middle-y ps-3",children:e.jsx("i",{"data-feather":"key",className:`${c==="password"?"text-primary":t==="dark"?"text-light":"text-muted"}`,style:{width:"18px",height:"18px"}})}),e.jsx(h,{variant:"link",className:"position-absolute top-50 end-0 translate-middle-y border-0 text-decoration-none p-0 pe-3",onClick:()=>F(!j),type:"button",children:e.jsx("i",{"data-feather":j?"eye-off":"eye",className:t==="dark"?"text-light":"text-muted",style:{width:"18px",height:"18px"}})})]}),l.password&&e.jsxs(a.Control.Feedback,{type:"invalid",className:"d-block",children:[e.jsx("i",{"data-feather":"x-circle",className:"me-1",style:{width:"14px",height:"14px"}}),l.password]})]}),e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsx(a.Check,{type:"checkbox",id:"remember-me",label:"Se souvenir de moi",className:t==="dark"?"text-light":"text-dark"})}),e.jsx(h,{type:"submit",variant:"primary",disabled:u,className:"w-100 py-3 fw-semibold text-white border-0 position-relative",style:{background:"linear-gradient(135deg, #007bff 0%, #0056b3 100%)",boxShadow:"0 4px 15px rgba(0, 123, 255, 0.3)"},children:u?e.jsxs(e.Fragment,{children:[e.jsx($,{animation:"border",size:"sm",className:"me-2"}),"Connexion en cours..."]}):e.jsx(e.Fragment,{children:"Se connecter"})})]}),x===2&&e.jsxs(a,{onSubmit:A,className:"needs-validation",noValidate:!0,children:[e.jsx("div",{className:"mb-4 p-3 rounded-3 bg-info bg-opacity-10",children:e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"mail",className:"text-info me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("small",{className:"fw-semibold text-info",children:"Vérification en deux étapes"}),e.jsxs("div",{className:`small mt-1 ${t==="dark"?"text-light":"text-muted"}`,children:["Un code de vérification a été envoyé à ",e.jsx("strong",{children:n.email})]})]})]})}),e.jsxs(a.Group,{className:"mb-4",children:[e.jsxs(a.Label,{className:`fw-semibold ${t==="dark"?"text-light":"text-dark"}`,children:[e.jsx("i",{"data-feather":"shield",className:"me-2",style:{width:"16px",height:"16px"}}),"Code de vérification"]}),e.jsxs("div",{className:"position-relative",children:[e.jsx(a.Control,{type:"text",name:"otp_code",placeholder:"123456",value:n.otp_code,onChange:N,onFocus:()=>m("otp_code"),onBlur:()=>m(null),isInvalid:!!l.otp_code,className:`py-3 ps-5 ${t==="dark"?"bg-dark text-light border-secondary":"bg-light"} ${c==="otp_code"?"border-primary shadow-sm":""}`,required:!0,maxLength:6}),e.jsx("div",{className:"position-absolute top-50 start-0 translate-middle-y ps-3",children:e.jsx("i",{"data-feather":"key",className:`${c==="otp_code"?"text-primary":t==="dark"?"text-light":"text-muted"}`,style:{width:"18px",height:"18px"}})})]}),l.otp_code&&e.jsxs(a.Control.Feedback,{type:"invalid",className:"d-block",children:[e.jsx("i",{"data-feather":"x-circle",className:"me-1",style:{width:"14px",height:"14px"}}),l.otp_code]})]}),e.jsx("div",{className:"text-center mb-4",children:e.jsxs(h,{variant:"link",onClick:T,className:"text-primary text-decoration-none",children:[e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}}),"Renvoyer le code"]})}),e.jsx(h,{type:"submit",variant:"success",disabled:u,className:"w-100 py-3 fw-semibold text-white border-0 position-relative",style:{background:"linear-gradient(135deg, #28a745 0%, #20c997 100%)",boxShadow:"0 4px 15px rgba(40, 167, 69, 0.3)"},children:u?e.jsxs(e.Fragment,{children:[e.jsx($,{animation:"border",size:"sm",className:"me-2"}),"Vérification..."]}):e.jsx(e.Fragment,{children:"Vérifier le code"})}),e.jsxs(h,{variant:"outline-secondary",onClick:()=>v(1),className:"w-100 mt-3 py-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Retour"]})]})]}),e.jsx(b.Footer,{className:`text-center py-3 border-0 ${t==="dark"?"bg-dark":"bg-light"}`,children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("i",{"data-feather":"shield",className:"text-success me-2",style:{width:"16px",height:"16px"}}),e.jsx("small",{className:`fw-semibold ${t==="dark"?"text-light":"text-muted"}`,children:"Authentification sécurisée à deux facteurs"})]})})]})]})})})})};export{Q as default};
