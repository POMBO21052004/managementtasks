import{u as M,c as O,r as l,f as P,j as e,L as w,a as k}from"./index-K0TI1Cn5.js";import{A as V}from"./Layout-MqCQlSlI.js";import{B as g,R as u,C as d,a as m}from"./Row-DpO6zsT4.js";import{A as T}from"./Alert-JqR1u8An.js";import{F as a}from"./Form-CAmGkuOD.js";import{B as U}from"./NavBar-BemxVd0Z.js";import{S as A}from"./Spinner-Br6_VxcD.js";import"./ElementChildren-DHcghUFE.js";function se(){const z=M(),f=O(),[b,C]=l.useState(!1),[S,E]=l.useState(null),[c,x]=l.useState({}),[r,L]=l.useState("light"),[i,$]=l.useState([]),[o,G]=l.useState([]),[y,D]=l.useState(!0),[N,F]=l.useState(!0),[p,I]=l.useState(null),[n,_]=l.useState({title:"",description:"",priority:"medium",status:"todo",due_date:"",user:"",project:""});l.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";L(s);const t=new MutationObserver(()=>{const j=document.documentElement.getAttribute("data-theme")||"light";L(j)});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]);const B=async()=>{try{D(!0),I(null);const s=await k.get("/auth/admin/users/");let t=[];Array.isArray(s.data)?t=s.data:s.data&&Array.isArray(s.data.results)?t=s.data.results:s.data&&Array.isArray(s.data.users)?t=s.data.users:(console.warn("‚ö†Ô∏è Format de r√©ponse inattendu:",s.data),t=[]),console.log("üìä Utilisateurs charg√©s:",t),$(t)}catch(s){console.error("‚ùå Erreur d√©taill√©e:",s);let t="Erreur lors du chargement des utilisateurs";s.response?t=`Erreur ${s.response.status}: ${s.response.data?.message||"Serveur inaccessible"}`:s.request?t="Impossible de contacter le serveur":t=s.message||"Erreur inattendue",I(t),$([])}finally{D(!1)}},R=async()=>{try{F(!0);const s=await k.get("/tasks/projects/");G(s.data.results||s.data||[])}catch(s){console.error("Erreur lors du chargement des projets",s)}finally{F(!1)}};l.useEffect(()=>{P.replace(),B(),R(),f.state?.project_id&&_(s=>({...s,project:f.state.project_id}))},[f]),l.useEffect(()=>{P.replace()},[i,o,y,N]);const h=s=>{const{name:t,value:j}=s.target;_(v=>({...v,[t]:j})),c[t]&&x(v=>({...v,[t]:null}))},q=async s=>{if(s.preventDefault(),!n.title.trim()){x({title:["Le titre est obligatoire"]});return}if(!n.user){x({user:["Veuillez s√©lectionner un utilisateur"]});return}try{C(!0),E(null),x({});const t={...n,project:n.project||null};(await k.post("/tasks/tasks/",t)).data&&z("/admin/tasks",{state:{message:"T√¢che cr√©√©e avec succ√®s ‚úÖ",type:"success"}})}catch(t){console.error("‚ùå Erreur cr√©ation t√¢che:",t),t.response?.data?.errors?x(t.response.data.errors):E(t.response?.data?.message||"Erreur lors de la cr√©ation de la t√¢che")}finally{C(!1)}},H=()=>{B()};return e.jsx(V,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${r==="dark"?"text-light":"text-dark"}`,children:"Cr√©er une nouvelle t√¢che"}),e.jsx("p",{className:`mb-0 ${r==="dark"?"text-light":"text-muted"}`,children:"Cr√©ation d'une nouvelle t√¢che pour un utilisateur"})]}),e.jsxs(g,{variant:"outline-secondary",as:w,to:"/admin/tasks",className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Retour"]})]}),S&&e.jsxs(T,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),e.jsx("strong",{children:"Erreur:"})," ",S]}),p&&e.jsx(T,{variant:"warning",className:"mb-4",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2"}),e.jsx("strong",{children:"Avertissement:"})," ",p]}),e.jsxs(g,{variant:"outline-warning",size:"sm",onClick:H,className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}}),"R√©essayer"]})]})}),e.jsx(a,{onSubmit:q,children:e.jsxs(u,{children:[e.jsx(d,{lg:8,className:"mb-4",children:e.jsxs(m,{className:`border-0 shadow-sm ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(m.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"plus-circle",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations de la t√¢che"]})}),e.jsxs(m.Body,{children:[e.jsx(u,{children:e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Assigner √† *",Array.isArray(i)&&i.length>0&&e.jsxs(U,{bg:"success",className:"ms-2",children:[i.length," utilisateur(s)"]})]}),y?e.jsxs("div",{className:"d-flex align-items-center p-3 border rounded",children:[e.jsx(A,{animation:"border",size:"sm",className:"me-2"}),e.jsx("span",{className:"text-muted",children:"Chargement des utilisateurs..."})]}):p?e.jsxs("div",{className:"p-3 border border-warning rounded bg-warning bg-opacity-10",children:[e.jsxs("div",{className:"text-warning mb-2",children:[e.jsx("i",{"data-feather":"users",className:"me-2"}),"Impossible de charger la liste des utilisateurs"]}),e.jsx("small",{className:"text-muted",children:"Vous pouvez cr√©er la t√¢che plus tard ou r√©essayer."})]}):!Array.isArray(i)||i.length===0?e.jsx("div",{className:"p-3 border border-info rounded bg-info bg-opacity-10",children:e.jsxs("div",{className:"text-info",children:[e.jsx("i",{"data-feather":"info",className:"me-2"}),"Aucun utilisateur disponible"]})}):e.jsxs(a.Select,{name:"user",value:n.user,onChange:h,isInvalid:!!c.user,className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0,children:[e.jsx("option",{value:"",children:"S√©lectionner un utilisateur..."}),i.map(s=>e.jsxs("option",{value:s.id,children:[s.username," - ",s.email,s.first_name&&s.last_name&&` (${s.first_name} ${s.last_name})`,s.is_admin&&" [ADMIN]"]},s.id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:c.user?.[0]})]})})}),e.jsx(u,{children:e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Projet (optionnel)",Array.isArray(o)&&o.length>0&&e.jsxs(U,{bg:"primary",className:"ms-2",children:[o.length," projet(s)"]})]}),N?e.jsxs("div",{className:"d-flex align-items-center p-3 border rounded",children:[e.jsx(A,{animation:"border",size:"sm",className:"me-2"}),e.jsx("span",{className:"text-muted",children:"Chargement des projets..."})]}):!Array.isArray(o)||o.length===0?e.jsxs("div",{className:"p-3 border border-info rounded bg-info bg-opacity-10",children:[e.jsxs("div",{className:"text-info",children:[e.jsx("i",{"data-feather":"folder",className:"me-2"}),"Aucun projet disponible"]}),e.jsx("small",{className:"text-muted",children:e.jsx(w,{to:"/admin/projects/create",className:"text-info",children:"Cr√©er un projet d'abord"})})]}):e.jsxs(a.Select,{name:"project",value:n.project,onChange:h,isInvalid:!!c.project,className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Aucun projet (t√¢che ind√©pendante)"}),o.map(s=>e.jsxs("option",{value:s.id,children:[s.title,s.status!=="active"&&` [${s.status}]`]},s.id))]}),e.jsx(a.Control.Feedback,{type:"invalid",children:c.project?.[0]})]})})}),e.jsx("hr",{className:"my-3"}),e.jsxs(u,{children:[e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"type",className:"me-2",style:{width:"16px",height:"16px"}}),"Titre de la t√¢che *"]}),e.jsx(a.Control,{type:"text",name:"title",value:n.title,onChange:h,placeholder:"Ex: D√©veloppement de la fonctionnalit√© X",isInvalid:!!c.title,className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(a.Control.Feedback,{type:"invalid",children:c.title?.[0]})]})}),e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"16px",height:"16px"}}),"Description"]}),e.jsx(a.Control,{as:"textarea",rows:4,name:"description",value:n.description,onChange:h,placeholder:"D√©crivez en d√©tail la t√¢che √† accomplir...",isInvalid:!!c.description,className:r==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:c.description?.[0]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"16px",height:"16px"}}),"Priorit√©"]}),e.jsxs(a.Select,{name:"priority",value:n.priority,onChange:h,className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"low",children:"üü¢ Basse"}),e.jsx("option",{value:"medium",children:"üü° Moyenne"}),e.jsx("option",{value:"high",children:"üî¥ Haute"})]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"activity",className:"me-2",style:{width:"16px",height:"16px"}}),"Statut initial"]}),e.jsxs(a.Select,{name:"status",value:n.status,onChange:h,className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"todo",children:"‚è≥ √Ä faire"}),e.jsx("option",{value:"in_progress",children:"üîÑ En cours"}),e.jsx("option",{value:"done",children:"‚úÖ Termin√©e"})]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"calendar",className:"me-2",style:{width:"16px",height:"16px"}}),"Date d'√©ch√©ance"]}),e.jsx(a.Control,{type:"date",name:"due_date",value:n.due_date,onChange:h,min:new Date().toISOString().split("T")[0],className:r==="dark"?"bg-dark text-light border-secondary":""})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(u,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{variant:"outline-secondary",as:w,to:"/admin/tasks",className:"me-2",disabled:b,children:"Annuler"}),e.jsx(g,{variant:"success",type:"submit",disabled:b||!Array.isArray(i)||i.length===0,className:"d-flex align-items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx(A,{animation:"border",size:"sm",className:"me-2"}),"Cr√©ation..."]}):e.jsx(e.Fragment,{children:!Array.isArray(i)||i.length===0?"Aucun utilisateur":"Cr√©er la t√¢che"})})]})})})]})]})}),e.jsxs(d,{lg:4,children:[e.jsxs(m,{className:`border-0 shadow-sm mb-4 ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(m.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-primary",style:{width:"20px",height:"20px"}}),"Informations"]})}),e.jsx(m.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{"data-feather":"users",className:"text-secondary me-2",style:{width:"14px",height:"14px"}}),e.jsxs("span",{children:["Utilisateurs charg√©s: ",e.jsx("strong",{children:Array.isArray(i)?i.length:0})]})]}),e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-secondary me-2",style:{width:"14px",height:"14px"}}),e.jsxs("span",{children:["Projets charg√©s: ",e.jsx("strong",{children:Array.isArray(o)?o.length:0})]})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"database",className:"text-secondary me-2",style:{width:"14px",height:"14px"}}),e.jsxs("span",{children:["Statut: ",y||N?"Chargement...":p?"Erreur":"Pr√™t"]})]})]})})]}),e.jsxs(m,{className:`border-0 shadow-sm mb-4 ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(m.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"help-circle",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"√Ä propos des projets"]})}),e.jsx(m.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les projets permettent d'organiser les t√¢ches par contexte"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"link",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Une t√¢che peut √™tre ind√©pendante ou li√©e √† un projet"})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"bar-chart",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les statistiques par projet aident au suivi global"})]})]})})]})]})]})})]})})}export{se as default};
