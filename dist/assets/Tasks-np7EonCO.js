import{d as H,r as i,a as C,f as B,j as e,L as o}from"./index-K0TI1Cn5.js";import{A as b}from"./Layout-MqCQlSlI.js";import{S as z}from"./Spinner-Br6_VxcD.js";import{A as q}from"./Alert-JqR1u8An.js";import{B as d,R as E,C as c,a as r}from"./Row-DpO6zsT4.js";import{B as g}from"./NavBar-BemxVd0Z.js";import{F as n}from"./Form-CAmGkuOD.js";import{T as O}from"./Table-fYcqLACk.js";import"./ElementChildren-DHcghUFE.js";function Y(){const{id:h}=H(),[p,A]=i.useState(null),[l,L]=i.useState([]),[f,v]=i.useState(!0),[s,y]=i.useState("light"),[k,R]=i.useState(null),[m,w]=i.useState(""),[x,T]=i.useState(""),[j,$]=i.useState("");i.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";y(t);const a=new MutationObserver(()=>{const u=document.documentElement.getAttribute("data-theme")||"light";y(u)});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>a.disconnect()},[]);const N=i.useCallback(async()=>{try{v(!0);const t=await C.get(`/tasks/projects/${h}/`);A(t.data);const a={project:h};m&&(a.search=m),x&&(a.priority=x),j&&(a.status=j);const u=await C.get("/tasks/tasks/",{params:a});L(u.data.results||u.data||[])}catch(t){console.error("Erreur lors du chargement des données",t),R("Erreur lors du chargement des données")}finally{v(!1)}},[h,m,x,j]);i.useEffect(()=>{B.replace(),N()},[N]),i.useEffect(()=>{B.replace()},[l,p]);const _=t=>({high:"danger",medium:"warning",low:"success"})[t]||"secondary",P=t=>({done:"success",in_progress:"primary",todo:"secondary"})[t]||"secondary",F=t=>({high:"Haute",medium:"Moyenne",low:"Basse"})[t]||t,M=t=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[t]||t,S=t=>t?new Date(t).toLocaleDateString("fr-FR"):"Non définie",D=()=>{if(!l.length)return 0;const t=l.filter(a=>a.status==="done").length;return Math.round(t/l.length*100)};return f?e.jsx(b,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(z,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des tâches du projet..."})]})}):k||!p?e.jsxs(b,{children:[e.jsxs(q,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),k||"Projet introuvable"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(d,{variant:"secondary",as:o,to:"/admin/projects",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour aux projets"]})})]}):e.jsx(b,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(d,{variant:"outline-secondary",size:"sm",as:o,to:`/admin/projects/${h}`,className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour au projet"]}),e.jsxs("div",{children:[e.jsxs("h1",{className:`h3 mb-0 ${s==="dark"?"text-light":"text-dark"}`,children:["Tâches du projet : ",p.title]}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsxs(g,{bg:"info",className:"px-2 py-1",children:[l.length," tâche(s)"]}),e.jsxs(g,{bg:"success",className:"px-2 py-1",children:[D(),"% terminé"]})]})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(d,{variant:"primary",as:o,to:"/admin/projects",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Tous les projets"]}),e.jsxs(d,{variant:"success",as:o,to:"/admin/tasks/create",state:{project_id:h},children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Nouvelle tâche"]})]})]}),e.jsxs(E,{className:"mb-4",children:[e.jsx(c,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("h3",{className:`mb-0 ${s==="dark"?"text-light":"text-dark"}`,children:l.length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Total Tâches"})]})})}),e.jsx(c,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("h3",{className:"mb-0 text-success",children:l.filter(t=>t.status==="done").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Terminées"})]})})}),e.jsx(c,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("h3",{className:"mb-0 text-primary",children:l.filter(t=>t.status==="in_progress").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"En Cours"})]})})}),e.jsx(c,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("h3",{className:"mb-0 text-warning",children:l.filter(t=>t.status==="todo").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"À Faire"})]})})})]}),e.jsx(r,{className:`border-0 shadow-sm mb-4 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(r.Body,{children:e.jsxs(E,{className:"g-3",children:[e.jsxs(c,{md:4,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Recherche"}),e.jsx(n.Control,{type:"text",placeholder:"Rechercher par titre ou description...",value:m,onChange:t=>w(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs(c,{md:3,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Priorité"}),e.jsxs(n.Select,{value:x,onChange:t=>T(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Toutes"}),e.jsx("option",{value:"high",children:"Haute"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"low",children:"Basse"})]})]}),e.jsxs(c,{md:3,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Statut"}),e.jsxs(n.Select,{value:j,onChange:t=>$(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]})]}),e.jsxs(c,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsx(d,{variant:"primary",className:"w-100",onClick:N,children:e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}})})]}),e.jsxs(c,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsx(d,{variant:"outline-secondary",className:"w-100",onClick:()=>{w(""),T(""),$("")},children:e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}})})]})]})})}),e.jsxs(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:`border-0 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"20px",height:"20px"}}),"Liste des Tâches (",l.length,")"]})})}),e.jsxs(r.Body,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(O,{hover:!0,className:`align-middle ${s==="dark"?"table-dark":""}`,children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tâche"}),e.jsx("th",{children:"Utilisateur"}),e.jsx("th",{className:"text-center",children:"Priorité"}),e.jsx("th",{className:"text-center",children:"Statut"}),e.jsx("th",{children:"Échéance"}),e.jsx("th",{className:"text-center",children:"Créée le"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:t.title}),t.description&&e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:t.description.length>100?`${t.description.substring(0,100)}...`:t.description})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`small ${s==="dark"?"text-light":"text-dark"}`,children:t.user_name||t.user_email}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:t.user_email})]})}),e.jsx("td",{className:"text-center",children:e.jsx(g,{bg:_(t.priority),children:F(t.priority)})}),e.jsx("td",{className:"text-center",children:e.jsx(g,{bg:P(t.status),children:M(t.status)})}),e.jsx("td",{children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:S(t.due_date)})}),e.jsx("td",{className:"text-center",children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:S(t.created_at)})}),e.jsx("td",{className:"text-center",children:e.jsx(d,{size:"sm",variant:"outline-info",as:o,to:`/admin/tasks/${t.id}`,title:"Voir les détails",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})})})]},t.id))})]})}),l.length===0&&!f&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"check-square",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsx("h6",{className:s==="dark"?"text-light":"text-dark",children:"Aucune tâche trouvée"}),e.jsx("p",{className:s==="dark"?"text-light":"text-muted",children:m||x||j?"Aucune tâche ne correspond à vos critères de recherche.":"Ce projet ne contient aucune tâche pour le moment."}),e.jsxs(d,{variant:"success",as:o,to:"/admin/tasks/create",state:{project_id:h},children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Ajouter la première tâche"]})]})]})]})]})})}export{Y as default};
