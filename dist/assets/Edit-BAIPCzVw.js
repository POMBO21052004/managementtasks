import{d as H,u as U,r as n,f as V,j as e,L as C,a as _}from"./index-K0TI1Cn5.js";import{A as S}from"./Layout-MqCQlSlI.js";import{S as G}from"./Spinner-Br6_VxcD.js";import{A as P}from"./Alert-JqR1u8An.js";import{B as x,R as E,C as i,a as p}from"./Row-DpO6zsT4.js";import{F as s}from"./Form-CAmGkuOD.js";import{M as g}from"./Modal-D-5iwAgh.js";import"./NavBar-BemxVd0Z.js";import"./ElementChildren-DHcghUFE.js";function se(){const{id:j}=H(),R=U(),[d,B]=n.useState(null),[I,D]=n.useState(!0),[u,b]=n.useState(!1),[N,c]=n.useState(null),[f,w]=n.useState({}),[r,L]=n.useState("light"),[$,y]=n.useState(!1),[o,F]=n.useState({username:"",email:"",first_name:"",last_name:"",phone:"",is_admin:!1,is_verified:!1}),[m,M]=n.useState({password:"",password_confirmation:""});n.useEffect(()=>{const l=document.documentElement.getAttribute("data-theme")||"light";L(l);const a=new MutationObserver(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";L(t)});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>a.disconnect()},[]),n.useEffect(()=>{j&&(async()=>{try{D(!0);const t=(await _.get(`/auth/admin/users/${j}/`)).data;B(t),F({username:t.username||"",email:t.email||"",first_name:t.first_name||"",last_name:t.last_name||"",phone:t.phone||"",is_admin:t.is_admin||!1,is_verified:t.is_verified||!1})}catch(a){c("Erreur lors du chargement des données"),console.error("Erreur:",a)}finally{D(!1)}})()},[j]),n.useEffect(()=>{V.replace()},[d]);const h=l=>{const{name:a,value:t,type:v,checked:q}=l.target;F(k=>({...k,[a]:v==="checkbox"?q:t})),f[a]&&w(k=>({...k,[a]:null}))},A=l=>{const{name:a,value:t}=l.target;M(v=>({...v,[a]:t}))},z=async l=>{l.preventDefault();try{b(!0),c(null),w({}),(await _.put(`/auth/admin/users/${j}/`,o)).data&&R("/admin/users")}catch(a){a.response?.data?.errors?w(a.response.data.errors):c(a.response?.data?.message||"Erreur lors de la mise à jour")}finally{b(!1)}},T=async l=>{if(l.preventDefault(),!m.password||!m.password_confirmation){c("Veuillez remplir tous les champs du mot de passe");return}if(m.password!==m.password_confirmation){c("Les mots de passe ne correspondent pas");return}try{b(!0),c(null),(await _.post(`/auth/admin/users/${j}/reset_password/`,{new_password:m.password})).data&&(y(!1),M({password:"",password_confirmation:""}))}catch(a){c(a.response?.data?.error||"Erreur lors de la mise à jour du mot de passe")}finally{b(!1)}};return I?e.jsx(S,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(G,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des données..."})]})}):N&&!d?e.jsxs(S,{children:[e.jsxs(P,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),N]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(x,{variant:"secondary",as:C,to:"/admin/users",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour à la liste"]})})]}):e.jsxs(S,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(x,{variant:"outline-secondary",size:"sm",as:C,to:"/admin/users",className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsx("h1",{className:"h3 mb-0",children:"Modifier l'utilisateur"})]}),e.jsxs("p",{className:"text-muted mb-0",children:["Modification des informations de ",d?.username]})]})}),N&&e.jsxs(P,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),N]}),e.jsx(s,{onSubmit:z,children:e.jsxs(E,{children:[e.jsx(i,{lg:8,className:"mb-4",children:e.jsxs(p,{className:`border-0 shadow-sm ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(p.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations personnelles"]})}),e.jsxs(p.Body,{children:[e.jsxs(E,{children:[e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Nom d'utilisateur *"]}),e.jsx(s.Control,{type:"text",name:"username",value:o.username,onChange:h,placeholder:"Nom d'utilisateur",isInvalid:!!f.username,className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(s.Control.Feedback,{type:"invalid",children:f.username?.[0]})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"mail",className:"me-2",style:{width:"16px",height:"16px"}}),"Email *"]}),e.jsx(s.Control,{type:"email",name:"email",value:o.email,onChange:h,placeholder:"nom@email.com",isInvalid:!!f.email,className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(s.Control.Feedback,{type:"invalid",children:f.email?.[0]})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Prénom"]}),e.jsx(s.Control,{type:"text",name:"first_name",value:o.first_name,onChange:h,placeholder:"Prénom",className:r==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Nom"]}),e.jsx(s.Control,{type:"text",name:"last_name",value:o.last_name,onChange:h,placeholder:"Nom",className:r==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"phone",className:"me-2",style:{width:"16px",height:"16px"}}),"Téléphone"]}),e.jsx(s.Control,{type:"tel",name:"phone",value:o.phone,onChange:h,placeholder:"Numéro de téléphone",className:r==="dark"?"bg-dark text-light border-secondary":""})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"Statuts"}),e.jsxs("div",{children:[e.jsx(s.Check,{type:"checkbox",name:"is_admin",label:"Administrateur",checked:o.is_admin,onChange:h,className:r==="dark"?"text-light":""}),e.jsx(s.Check,{type:"checkbox",name:"is_verified",label:"Vérifié",checked:o.is_verified,onChange:h,className:r==="dark"?"text-light":""})]})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(E,{children:e.jsx(i,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsxs(x,{variant:"outline-warning",onClick:()=>y(!0),className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"lock",className:"me-2",style:{width:"16px",height:"16px"}}),"Changer le mot de passe"]}),e.jsxs("div",{children:[e.jsx(x,{variant:"outline-secondary",as:C,to:"/admin/users",className:"me-2",disabled:u,children:"Annuler"}),e.jsx(x,{variant:"primary",type:"submit",disabled:u,className:"d-flex align-items-center",children:u?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Mise à jour..."]}):e.jsxs(e.Fragment,{children:[e.jsx("i",{"data-feather":"save",className:"me-2",style:{width:"16px",height:"16px"}}),"Enregistrer les Modifications"]})})]})]})})})]})]})}),e.jsx(i,{lg:4,children:d&&e.jsxs(p,{className:`border-0 shadow-sm mb-4 ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(p.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-success",style:{width:"20px",height:"20px"}}),"Informations actuelles"]})}),e.jsxs(p.Body,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"ID"}),e.jsx("code",{className:"px-2 py-1 bg-primary bg-opacity-10 rounded text-primary small",children:d.id})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Date de création"}),e.jsx("span",{className:"small",children:new Date(d.date_joined).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Dernière connexion"}),e.jsx("span",{className:"small",children:d.last_login?new Date(d.last_login).toLocaleDateString("fr-FR"):"Jamais"})]})]})]})})]})}),e.jsxs(g,{show:$,onHide:()=>y(!1),centered:!0,contentClassName:r==="dark"?"bg-dark text-light":"",children:[e.jsx(g.Header,{closeButton:!0,className:r==="dark"?"bg-dark text-light border-secondary":"",children:e.jsxs(g.Title,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"lock",className:"me-2",style:{width:"20px",height:"20px"}}),"Changer le mot de passe"]})}),e.jsxs(s,{onSubmit:T,children:[e.jsxs(g.Body,{className:r==="dark"?"bg-dark text-light":"",children:[e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Nouveau mot de passe"}),e.jsx(s.Control,{type:"password",name:"password",value:m.password,onChange:A,placeholder:"Entrez le nouveau mot de passe",className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0})]}),e.jsxs(s.Group,{className:"mb-3",children:[e.jsx(s.Label,{children:"Confirmer le mot de passe"}),e.jsx(s.Control,{type:"password",name:"password_confirmation",value:m.password_confirmation,onChange:A,placeholder:"Confirmez le nouveau mot de passe",className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0})]})]}),e.jsxs(g.Footer,{className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(x,{variant:"secondary",onClick:()=>y(!1),disabled:u,children:"Annuler"}),e.jsx(x,{variant:"primary",type:"submit",disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(G,{animation:"border",size:"sm",className:"me-2"}),"Mise à jour..."]}):"Mettre à jour"})]})]})]})]})}export{se as default};
