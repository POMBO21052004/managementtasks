import{r as d,j as e,b as H,u as q,f as J,L as A,a as D}from"./index-K0TI1Cn5.js";import{A as O}from"./Layout-MqCQlSlI.js";import{A as W}from"./Layout-Dp7EFE9w.js";import{S as G}from"./Spinner-Br6_VxcD.js";import{A as R}from"./Alert-JqR1u8An.js";import{u as K,c as Q,P as j,B as g,R as y,C as h,a as p}from"./Row-DpO6zsT4.js";import{F as a}from"./Form-CAmGkuOD.js";import"./NavBar-BemxVd0Z.js";import"./ElementChildren-DHcghUFE.js";j.string,j.bool,j.bool,j.bool,j.bool;const U=d.forwardRef(({bsPrefix:x,className:v,fluid:w=!1,rounded:_=!1,roundedCircle:t=!1,thumbnail:k=!1,...C},b)=>(x=K(x,"img"),e.jsx("img",{ref:b,...C,className:Q(v,w&&`${x}-fluid`,_&&"rounded",t&&"rounded-circle",k&&`${x}-thumbnail`)})));U.displayName="Image";function le(){const{user:x,isAdmin:v,updateUser:w}=H(),_=q(),[t,k]=d.useState(null),[C,b]=d.useState(!0),[E,L]=d.useState(!1),[N,S]=d.useState(null),[i,u]=d.useState({}),[l,P]=d.useState("light"),[B,$]=d.useState(null),[c,F]=d.useState({first_name:"",last_name:"",email:"",phone:"",username:"",profile_picture:null}),I=v?O:W;d.useEffect(()=>{const n=document.documentElement.getAttribute("data-theme")||"light";P(n);const s=new MutationObserver(()=>{const r=document.documentElement.getAttribute("data-theme")||"light";P(r)});return s.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>s.disconnect()},[]),d.useEffect(()=>{(async()=>{try{b(!0);const r=(await D.get("/auth/profile")).data;k(r),F({first_name:r.first_name||"",last_name:r.last_name||"",email:r.email||"",phone:r.phone||"",username:r.username||"",profile_picture:null}),r.profile_picture&&$(r.profile_picture)}catch(s){S("Erreur lors du chargement du profil"),console.error("Erreur:",s)}finally{b(!1)}})()},[]),d.useEffect(()=>{J.replace()},[t]);const f=n=>{const{name:s,value:r}=n.target;F(o=>({...o,[s]:r})),i[s]&&u(o=>({...o,[s]:null}))},M=n=>{const s=n.target.files[0];if(s){if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(s.type)){u(m=>({...m,profile_picture:"Format de fichier non supporté. Utilisez JPG, PNG ou WEBP."}));return}if(s.size>2097152){u(m=>({...m,profile_picture:"La taille du fichier ne doit pas dépasser 2MB."}));return}F(m=>({...m,profile_picture:s}));const T=new FileReader;T.onload=m=>{$(m.target.result)},T.readAsDataURL(s),i.profile_picture&&u(m=>({...m,profile_picture:null}))}},z=async n=>{n.preventDefault();try{L(!0),S(null),u({});const s=new FormData;Object.keys(c).forEach(o=>{o==="profile_picture"?c.profile_picture instanceof File&&s.append("profile_picture",c.profile_picture):c[o]!==null&&c[o]!==""&&s.append(o,c[o])});const r=await D.put("/auth/profile/update",s,{headers:{"Content-Type":"multipart/form-data"}});r.data&&(w(r.data),_("/profile",{state:{message:"Profil mis à jour avec succès ✅",type:"success"}}))}catch(s){s.response?.data?.errors?u(s.response.data.errors):S(s.response?.data?.message||"Erreur lors de la mise à jour du profil")}finally{L(!1)}},V=(n,s)=>n&&n.split(" ").length>1?n.split(" ").map(r=>r[0]).join("").toUpperCase().slice(0,2):s?s.substring(0,2).toUpperCase():"US";return C?e.jsx(I,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(G,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement de votre profil..."})]})}):N&&!t?e.jsxs(I,{children:[e.jsxs(R,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),N]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(g,{variant:"secondary",as:A,to:"/profile",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour au profil"]})})]}):e.jsx(I,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${l==="dark"?"text-light":"text-dark"}`,children:"Modifier mon profil"}),e.jsx("p",{className:`mb-0 ${l==="dark"?"text-light":"text-muted"}`,children:"Mise à jour des informations personnelles"})]}),e.jsxs(g,{variant:"outline-secondary",as:A,to:"/profile",className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Annuler"]})]}),N&&e.jsxs(R,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),N]}),e.jsx(a,{onSubmit:z,children:e.jsxs(y,{children:[e.jsx(h,{lg:8,className:"mb-4",children:e.jsxs(p,{className:`border-0 shadow-sm ${l==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(p.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations personnelles"]})}),e.jsxs(p.Body,{children:[e.jsx(y,{className:"mb-4",children:e.jsxs(h,{md:3,className:"text-center",children:[e.jsxs("div",{className:"position-relative d-inline-block mb-3",children:[B?e.jsx(U,{src:B,alt:"Photo de profil",className:"rounded-circle",width:"120",height:"120",style:{objectFit:"cover"}}):e.jsx("div",{className:"rounded-circle bg-primary bg-opacity-10 d-flex align-items-center justify-content-center border",style:{width:"120px",height:"120px"},children:e.jsx("span",{className:"text-primary fw-bold fs-4",children:V(t.name||t.username,t.email)})}),e.jsx(g,{variant:"primary",size:"sm",className:"position-absolute bottom-0 end-0 rounded-circle p-2",style:{transform:"translate(25%, 25%)"},onClick:()=>document.getElementById("profileImage").click(),children:e.jsx("i",{"data-feather":"camera",style:{width:"12px",height:"12px"}})})]}),e.jsx("input",{type:"file",id:"profileImage",accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:M,style:{display:"none"}}),e.jsx("p",{className:"small text-muted mb-0",children:"JPG, PNG, WEBP - Max 2MB"}),i.profile_picture&&e.jsx("div",{className:"text-danger small mt-1",children:i.profile_picture})]})}),e.jsxs(y,{children:[e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Prénom"]}),e.jsx(a.Control,{type:"text",name:"first_name",value:c.first_name,onChange:f,placeholder:"Votre prénom",isInvalid:!!i.first_name,className:l==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:i.first_name?.[0]})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Nom"]}),e.jsx(a.Control,{type:"text",name:"last_name",value:c.last_name,onChange:f,placeholder:"Votre nom",isInvalid:!!i.last_name,className:l==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:i.last_name?.[0]})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"user",className:"me-2",style:{width:"16px",height:"16px"}}),"Nom d'utilisateur *"]}),e.jsx(a.Control,{type:"text",name:"username",value:c.username,onChange:f,placeholder:"Votre nom d'utilisateur",isInvalid:!!i.username,className:l==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(a.Control.Feedback,{type:"invalid",children:i.username?.[0]})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"mail",className:"me-2",style:{width:"16px",height:"16px"}}),"Email *"]}),e.jsx(a.Control,{type:"email",name:"email",value:c.email,onChange:f,placeholder:"votre@email.com",isInvalid:!!i.email,className:l==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(a.Control.Feedback,{type:"invalid",children:i.email?.[0]})]})}),e.jsx(h,{md:6,className:"mb-3",children:e.jsxs(a.Group,{children:[e.jsxs(a.Label,{children:[e.jsx("i",{"data-feather":"phone",className:"me-2",style:{width:"16px",height:"16px"}}),"Téléphone"]}),e.jsx(a.Control,{type:"tel",name:"phone",value:c.phone,onChange:f,placeholder:"Votre numéro de téléphone",isInvalid:!!i.phone,className:l==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(a.Control.Feedback,{type:"invalid",children:i.phone?.[0]})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(y,{children:e.jsx(h,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(g,{variant:"outline-secondary",as:A,to:"/profile",className:"me-2",disabled:E,children:"Annuler"}),e.jsx(g,{variant:"primary",type:"submit",disabled:E,className:"d-flex align-items-center",children:E?e.jsxs(e.Fragment,{children:[e.jsx(G,{animation:"border",size:"sm",className:"me-2"}),"Mise à jour..."]}):e.jsx(e.Fragment,{children:"Enregistrer les modifications"})})]})})})]})]})}),e.jsxs(h,{lg:4,children:[t&&e.jsxs(p,{className:`border-0 shadow-sm mb-4 ${l==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(p.Header,{className:`border-0 ${l==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-success",style:{width:"20px",height:"20px"}}),"Informations actuelles"]})}),e.jsxs(p.Body,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Rôle"}),e.jsx("span",{className:"small fw-bold badge bg-primary",children:t.is_admin?"Administrateur":"Utilisateur"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Statut"}),e.jsx("span",{className:`small fw-bold badge ${t.is_verified?"bg-success":"bg-warning"}`,children:t.is_verified?"Vérifié":"En attente"})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Membre depuis"}),e.jsx("span",{className:"small",children:new Date(t.date_joined).toLocaleDateString("fr-FR")})]})]})]}),e.jsxs(p,{className:`border-0 shadow-sm mb-4 ${l==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(p.Header,{className:`border-0 ${l==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"help-circle",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"Conseils"]})}),e.jsx(p.Body,{children:e.jsx("div",{className:"small",children:e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"user",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsxs("div",{children:[e.jsxs("p",{className:"mb-0",children:["Nom : ",t.name]}),e.jsxs("p",{className:"mb-0",children:["Nom d'utilisateur : ",t.username]}),e.jsxs("p",{className:"mb-0",children:["Email : ",t.email]}),e.jsxs("p",{className:"mb-0",children:["Téléphone : ",t.phone]})]})]})})})]})]})]})})]})})}export{le as default};
