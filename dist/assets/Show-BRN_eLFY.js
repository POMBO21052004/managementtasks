import{d as M,u as H,r as n,f as L,j as e,L as o,a as p}from"./index-K0TI1Cn5.js";import{A as y}from"./Layout-MqCQlSlI.js";import{S as R}from"./Spinner-Br6_VxcD.js";import{A as F}from"./Alert-JqR1u8An.js";import{B as m,R as g,C as i,a as r}from"./Row-DpO6zsT4.js";import{B as h}from"./NavBar-BemxVd0Z.js";import{P as q}from"./ProgressBar-Dzhpx0Dl.js";import{M as u}from"./Modal-D-5iwAgh.js";import"./ElementChildren-DHcghUFE.js";function X(){const{id:l}=M(),$=H(),[a,v]=n.useState(null),[s,A]=n.useState(null),[B,w]=n.useState(!0),[z,C]=n.useState(!0),[k,N]=n.useState(null),[d,_]=n.useState("light"),[P,f]=n.useState(!1);n.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";_(t);const c=new MutationObserver(()=>{const b=document.documentElement.getAttribute("data-theme")||"light";_(b)});return c.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>c.disconnect()},[]),n.useEffect(()=>{l&&(async()=>{try{w(!0);const c=await p.get(`/tasks/projects/${l}/`);v(c.data);const b=await p.get(`/tasks/projects/${l}/statistics/`);A(b.data)}catch(c){N("Erreur lors du chargement du projet"),console.error("Erreur:",c)}finally{w(!1),C(!1)}})()},[l]),n.useEffect(()=>{L.replace()},[a,s]);const T=async()=>{try{await p.delete(`/tasks/projects/${l}/`),$("/admin/projects",{state:{message:"Projet supprim√© avec succ√®s ‚úÖ",type:"success"}})}catch(t){console.error(t),N("Erreur lors de la suppression")}f(!1)},D=async()=>{try{await p.post(`/tasks/projects/${l}/mark_completed/`);const t=await p.get(`/tasks/projects/${l}/`);v(t.data)}catch(t){console.error(t),N("Erreur lors de la modification")}},S=t=>({active:"success",completed:"primary",archived:"secondary",on_hold:"warning"})[t]||"secondary",E=t=>({active:"Actif",completed:"Termin√©",archived:"Archiv√©",on_hold:"En pause"})[t]||t,x=t=>t?new Date(t).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Non d√©finie",j=()=>!s||!s.total_tasks?0:Math.round(s.completed_tasks/s.total_tasks*100);return B?e.jsx(y,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(R,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des informations du projet..."})]})}):k||!a?e.jsxs(y,{children:[e.jsxs(F,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),k||"Projet introuvable"]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(m,{variant:"secondary",as:o,to:"/admin/projects",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour √† la liste"]})})]}):e.jsxs(y,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(m,{variant:"outline-secondary",size:"sm",as:o,to:"/admin/projects",className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-0 ${d==="dark"?"text-light":"text-dark"}`,children:a.title}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsx(h,{bg:S(a.status),className:"px-2 py-1",children:E(a.status)}),s&&e.jsxs(h,{bg:"info",className:"px-2 py-1",children:[s.total_tasks||0," t√¢ches"]})]})]})]})}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(m,{variant:"primary",as:o,to:`/admin/projects/${l}/edit`,children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"16px",height:"16px"}}),"Modifier"]}),e.jsxs(m,{variant:"danger",onClick:()=>f(!0),children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer"]})]})]}),e.jsxs(g,{children:[e.jsxs(i,{lg:8,children:[e.jsxs(r,{className:`border-0 shadow-sm mb-4 ${d==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"20px",height:"20px"}}),"D√©tails du projet"]})}),e.jsxs(r.Body,{children:[e.jsx(g,{className:"mb-4",children:e.jsxs(i,{md:12,children:[e.jsx("h4",{className:"mb-3",children:a.title}),a.description?e.jsx("div",{className:`p-3 rounded ${d==="dark"?"bg-dark border":"bg-light"}`,children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:a.description})}):e.jsx("p",{className:"text-muted fst-italic",children:"Aucune description fournie"})]})}),e.jsx("hr",{className:"my-4"}),e.jsxs(g,{children:[e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Statut :"}),e.jsx(h,{bg:S(a.status),children:E(a.status)})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"T√¢ches totales :"}),e.jsx("span",{className:"fw-medium",children:s?.total_tasks||0})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"T√¢ches termin√©es :"}),e.jsx("span",{className:"fw-medium text-success",children:s?.completed_tasks||0})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Taux d'ach√®vement :"}),e.jsxs("span",{className:"fw-medium text-info",children:[j(),"%"]})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Cr√©√© le :"}),e.jsx("span",{className:"fw-medium",children:x(a.created_at)})]})}),e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Derni√®re modification :"}),e.jsx("span",{className:"fw-medium",children:x(a.updated_at)})]})}),a.completed_at&&e.jsx(i,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Termin√© le :"}),e.jsx("span",{className:"fw-medium text-success",children:x(a.completed_at)})]})})]})]})]}),s&&e.jsxs(r,{className:`border-0 shadow-sm mb-4 ${d==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"bar-chart",className:"me-2",style:{width:"20px",height:"20px"}}),"Statistiques du projet"]})}),e.jsxs(r.Body,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Progression globale"}),e.jsxs("span",{className:"fw-bold",children:[j(),"%"]})]}),e.jsx(q,{now:j(),variant:j()>=80?"success":j()>=50?"warning":"danger",style:{height:"10px"}})]}),e.jsxs(g,{children:[e.jsxs(i,{md:6,children:[e.jsx("h6",{className:"mb-3",children:"Par priorit√©"}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"üî¥ Haute"}),e.jsx(h,{bg:"danger",children:s.by_priority?.high||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"üü° Moyenne"}),e.jsx(h,{bg:"warning",children:s.by_priority?.medium||0})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"üü¢ Basse"}),e.jsx(h,{bg:"success",children:s.by_priority?.low||0})]})]}),e.jsxs(i,{md:6,children:[e.jsx("h6",{className:"mb-3",children:"Par statut"}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"‚è≥ √Ä faire"}),e.jsx(h,{bg:"secondary",children:s.by_status?.todo||0})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{children:"üîÑ En cours"}),e.jsx(h,{bg:"primary",children:s.by_status?.in_progress||0})]}),e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{children:"‚úÖ Termin√©e"}),e.jsx(h,{bg:"success",children:s.by_status?.done||0})]})]})]})]})]})]}),e.jsxs(i,{lg:4,children:[e.jsxs(r,{className:`border-0 shadow-sm mb-4 ${d==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"zap",className:"me-2",style:{width:"20px",height:"20px"}}),"Actions rapides"]})}),e.jsx(r.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(m,{variant:"primary",as:o,to:`/admin/projects/${l}/tasks`,children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir toutes les t√¢ches"]}),e.jsxs(m,{variant:"success",as:o,to:"/admin/tasks/create",state:{project_id:l},children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Ajouter une t√¢che"]}),a.status!=="completed"&&e.jsxs(m,{variant:"outline-success",onClick:D,children:[e.jsx("i",{"data-feather":"check-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer comme termin√©"]}),e.jsxs(m,{variant:"outline-primary",as:o,to:"/admin/projects",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Tous les projets"]})]})})]}),s?.users_stats&&s.users_stats.length>0&&e.jsxs(r,{className:`border-0 shadow-sm mb-4 ${d==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"users",className:"me-2",style:{width:"20px",height:"20px"}}),"Utilisateurs assign√©s"]})}),e.jsx(r.Body,{children:s.users_stats.map((t,c)=>e.jsxs("div",{className:`d-flex justify-content-between align-items-center ${c>0?"mt-2 pt-2 border-top":""}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"small fw-medium",children:t.user.username}),e.jsx("div",{className:"small text-muted",children:t.user.email})]}),e.jsx("div",{className:"text-end",children:e.jsx(h,{bg:"primary",children:t.total_tasks})})]},t.user.id))})]}),e.jsxs(r,{className:`border-0 shadow-sm ${d==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-secondary",style:{width:"20px",height:"20px"}}),"Informations syst√®me"]})}),e.jsx(r.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"hash",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"ID Projet"}),e.jsx("div",{className:"text-muted",children:a.id})]})]}),e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"calendar",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Date de cr√©ation"}),e.jsx("div",{className:"text-muted",children:x(a.created_at)})]})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"clock",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Derni√®re modification"}),e.jsx("div",{className:"text-muted",children:x(a.updated_at)})]})]})]})})]})]})]}),e.jsxs(u,{show:P,onHide:()=>f(!1),centered:!0,contentClassName:d==="dark"?"bg-dark text-light":"",children:[e.jsx(u.Header,{className:d==="dark"?"bg-dark text-light border-secondary":"",closeButton:!0,children:e.jsx(u.Title,{children:"Confirmation de Suppression"})}),e.jsxs(u.Body,{className:d==="dark"?"bg-dark text-light":"",children:[e.jsx("p",{children:"√ätes-vous s√ªr de vouloir supprimer ce projet ?"}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2",style:{width:"16px",height:"16px"}}),'Cette action est irr√©versible. Le projet "',a.title,'" sera d√©finitivement supprim√©.']}),s&&s.total_tasks>0&&e.jsxs("div",{className:"alert alert-danger",children:[e.jsx("i",{"data-feather":"alert-octagon",className:"me-2",style:{width:"16px",height:"16px"}}),e.jsx("strong",{children:"Attention :"})," ",s.total_tasks," t√¢ches associ√©es seront √©galement supprim√©es !"]})]}),e.jsxs(u.Footer,{className:d==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(m,{variant:"secondary",onClick:()=>f(!1),children:"Annuler"}),e.jsxs(m,{variant:"danger",onClick:T,children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer d√©finitivement"]})]})]})]})}export{X as default};
