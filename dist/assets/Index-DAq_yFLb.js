import{r as l,a as C,f as B,j as e,L as u}from"./index-hRRtG8yy.js";import{A as D}from"./Layout-DZHbYMkx.js";import{B as j,a as r,R as F,C as i}from"./Row-bX7h-1jy.js";import{F as c}from"./Form-Dsmz1YOZ.js";import{B as m}from"./NavBar-mvMqGCSV.js";import{T as H}from"./Table-qWWWCHOI.js";import"./ElementChildren-NDIL728O.js";function Q(){const[a,P]=l.useState([]),[g,_]=l.useState([]),[v,k]=l.useState(!0),[s,w]=l.useState("light"),[h,p]=l.useState(""),[o,N]=l.useState(""),[x,b]=l.useState(""),[n,f]=l.useState(""),[q,z]=l.useState("");l.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";w(t);const d=new MutationObserver(()=>{const M=document.documentElement.getAttribute("data-theme")||"light";w(M)});return d.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>d.disconnect()},[]);const E=async()=>{try{const t=await C.get("/tasks/projects/");_(t.data.results||t.data||[])}catch(t){console.error("Erreur lors du chargement des projets",t)}},y=l.useCallback(async()=>{try{k(!0);const t={};h&&(t.search=h),o&&(t.priority=o),x&&(t.status=x),n&&(t.project=n);const d=await C.get("/tasks/tasks/",{params:t});P(d.data.results||d.data||[])}catch(t){console.error("Erreur lors du chargement des tâches",t)}finally{k(!1)}},[h,o,x,n]);l.useEffect(()=>{B.replace(),y(),E()},[y]),l.useEffect(()=>{B.replace()},[a,g]);const L=t=>({high:"danger",medium:"warning",low:"success"})[t]||"secondary",A=t=>({done:"success",in_progress:"primary",todo:"secondary"})[t]||"secondary",$=t=>({high:"Haute",medium:"Moyenne",low:"Basse"})[t]||t,S=t=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[t]||t,T=t=>t?new Date(t).toLocaleDateString("fr-FR"):"Non définie",R=()=>{p(""),N(""),b(""),f("")};return e.jsx(D,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${s==="dark"?"text-light":"text-dark"}`,children:"Gestion des Tâches"}),e.jsx("p",{className:`mb-0 ${s==="dark"?"text-light":"text-muted"}`,children:"Administration de toutes les tâches des utilisateurs"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(j,{variant:"primary",as:u,to:"/admin/dashboard",children:[e.jsx("i",{"data-feather":"bar-chart",className:"me-2",style:{width:"16px",height:"16px"}}),"Dashboard"]}),e.jsxs(j,{variant:"success",as:u,to:"/admin/tasks/create",children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Nouvelle Tâche"]})]})]}),e.jsx(r,{className:`border-0 shadow-sm mb-4 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{children:[e.jsxs(F,{className:"g-3",children:[e.jsxs(i,{md:3,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Recherche"}),e.jsx(c.Control,{type:"text",placeholder:"Rechercher par titre ou description...",value:h,onChange:t=>p(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs(i,{md:2,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Priorité"}),e.jsxs(c.Select,{value:o,onChange:t=>N(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Toutes"}),e.jsx("option",{value:"high",children:"Haute"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"low",children:"Basse"})]})]}),e.jsxs(i,{md:2,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Statut"}),e.jsxs(c.Select,{value:x,onChange:t=>b(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]})]}),e.jsxs(i,{md:3,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Projet"}),e.jsxs(c.Select,{value:n,onChange:t=>f(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous les projets"}),e.jsx("option",{value:"none",children:"Sans projet"}),g.map(t=>e.jsxs("option",{value:t.id,children:[t.title,t.status!=="active"&&` [${t.status}]`]},t.id))]})]}),e.jsxs(i,{md:1,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsx(j,{variant:"primary",className:"w-100",onClick:y,children:e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}})})]}),e.jsxs(i,{md:1,children:[e.jsx(c.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsx(j,{variant:"outline-secondary",className:"w-100",onClick:R,children:e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}})})]})]}),(h||o||x||n)&&e.jsx("div",{className:"mt-3 pt-3 border-top",children:e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("small",{className:"text-muted me-2",children:"Filtres actifs :"}),e.jsxs("div",{className:"d-flex flex-wrap gap-1",children:[h&&e.jsxs(m,{bg:"info",className:"d-flex align-items-center",children:['Recherche: "',h,'"',e.jsx("i",{"data-feather":"x",className:"ms-1 cursor-pointer",style:{width:"12px",height:"12px"},onClick:()=>p("")})]}),o&&e.jsxs(m,{bg:"warning",className:"d-flex align-items-center",children:["Priorité: ",$(o),e.jsx("i",{"data-feather":"x",className:"ms-1 cursor-pointer",style:{width:"12px",height:"12px"},onClick:()=>N("")})]}),x&&e.jsxs(m,{bg:"primary",className:"d-flex align-items-center",children:["Statut: ",S(x),e.jsx("i",{"data-feather":"x",className:"ms-1 cursor-pointer",style:{width:"12px",height:"12px"},onClick:()=>b("")})]}),n&&e.jsxs(m,{bg:"success",className:"d-flex align-items-center",children:["Projet: ",n==="none"?"Sans projet":g.find(t=>t.id==n)?.title,e.jsx("i",{"data-feather":"x",className:"ms-1 cursor-pointer",style:{width:"12px",height:"12px"},onClick:()=>f("")})]})]})]})})]})}),e.jsxs(F,{className:"mb-4",children:[e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:`h5 mb-1 ${s==="dark"?"text-light":"text-dark"}`,children:a.length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Total"})]})})}),e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-success",children:a.filter(t=>t.status==="done").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Terminées"})]})})}),e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-primary",children:a.filter(t=>t.status==="in_progress").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"En Cours"})]})})}),e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-warning",children:a.filter(t=>t.status==="todo").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"À Faire"})]})})}),e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-info",children:a.filter(t=>t.project).length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Avec Projet"})]})})}),e.jsx(i,{md:2,children:e.jsx(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-secondary",children:a.filter(t=>!t.project).length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Sans Projet"})]})})})]}),e.jsxs(r,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:`border-0 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"check-square",className:"me-2",style:{width:"20px",height:"20px"}}),"Liste des Tâches (",a.length,")"]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("small",{className:`me-2 ${s==="dark"?"text-light":"text-muted"}`,children:"Taux d'achèvement:"}),e.jsxs(m,{bg:a.length>0?a.filter(t=>t.status==="done").length/a.length>=.8?"success":a.filter(t=>t.status==="done").length/a.length>=.5?"warning":"danger":"secondary",children:[a.length>0?Math.round(a.filter(t=>t.status==="done").length/a.length*100):0,"%"]})]})]})}),e.jsxs(r.Body,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(H,{hover:!0,className:`align-middle ${s==="dark"?"table-dark":""}`,children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tâche"}),e.jsx("th",{children:"Utilisateur"}),e.jsx("th",{className:"text-center",children:"Projet"}),e.jsx("th",{className:"text-center",children:"Priorité"}),e.jsx("th",{className:"text-center",children:"Statut"}),e.jsx("th",{children:"Échéance"}),e.jsx("th",{className:"text-center",children:"Créée le"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:t.title}),t.description&&e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:t.description.length>100?`${t.description.substring(0,100)}...`:t.description})]})}),e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`small ${s==="dark"?"text-light":"text-dark"}`,children:t.user_name||t.user_email}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:t.user_email})]})}),e.jsx("td",{className:"text-center",children:t.project_title?e.jsx(m,{bg:"info",className:"cursor-pointer",as:u,to:`/admin/projects/${t.project}/tasks`,onClick:d=>d.stopPropagation(),title:t.project_title,children:t.project_title?t.project_title.length>10?t.project_title.substring(0,10)+"...":t.project_title:"Non spécifié"}):e.jsx("small",{className:"text-muted",children:"Aucun"})}),e.jsx("td",{className:"text-center",children:e.jsx(m,{bg:L(t.priority),children:$(t.priority)})}),e.jsx("td",{className:"text-center",children:e.jsx(m,{bg:A(t.status),children:S(t.status)})}),e.jsx("td",{children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:T(t.due_date)})}),e.jsx("td",{className:"text-center",children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:T(t.created_at)})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex gap-1 justify-content-center",children:[e.jsx(j,{size:"sm",variant:"outline-info",as:u,to:`/admin/tasks/${t.id}`,title:"Voir les détails",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})}),e.jsx(j,{size:"sm",variant:"outline-warning",as:u,to:`/admin/tasks/${t.id}/edit`,title:"Modifier",children:e.jsx("i",{"data-feather":"edit",style:{width:"14px",height:"14px"}})})]})})]},t.id))})]})}),a.length===0&&!v&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"check-square",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsx("h6",{className:s==="dark"?"text-light":"text-dark",children:"Aucune tâche trouvée"}),e.jsx("p",{className:s==="dark"?"text-light":"text-muted",children:h||o||x||n?"Aucune tâche ne correspond à vos critères de recherche.":"Aucune tâche n'a été créée pour le moment."}),e.jsxs(j,{variant:"success",as:u,to:"/admin/tasks/create",children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Créer la première tâche"]})]}),v&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Chargement..."})}),e.jsx("p",{className:"mt-2",children:"Chargement des tâches..."})]})]})]})]})})}export{Q as default};
