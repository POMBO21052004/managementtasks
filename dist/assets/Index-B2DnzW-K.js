import{r as a,a as g,f as L,j as e,L as p}from"./index-K0TI1Cn5.js";import{A as te}from"./Layout-Dp7EFE9w.js";import{B as d,a as l,R as A,C as c}from"./Row-DpO6zsT4.js";import{F as n}from"./Form-CAmGkuOD.js";import{T as se}from"./Table-fYcqLACk.js";import{B as f}from"./NavBar-BemxVd0Z.js";import{M as b}from"./Modal-D-5iwAgh.js";import{T as re,a as v}from"./ToastContainer-Zqrc0L-G.js";import"./ElementChildren-DHcghUFE.js";function xe(){const[i,w]=a.useState([]),[T,D]=a.useState([]),[S,C]=a.useState(!0),[s,$]=a.useState("light"),[h,E]=a.useState(""),[m,B]=a.useState(""),[x,M]=a.useState(""),[u,_]=a.useState(""),[R,k]=a.useState(!1),[N,q]=a.useState(null),[H,F]=a.useState(!1),[z,O]=a.useState(""),[y,V]=a.useState("success");a.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";$(t);const r=new MutationObserver(()=>{const ee=document.documentElement.getAttribute("data-theme")||"light";$(ee)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]);const o=(t,r="success")=>{O(t),V(r),F(!0)},G=async()=>{try{const t=await g.get("/tasks/projects/");D(t.data.results||t.data||[])}catch(t){console.error("Erreur lors du chargement des projets",t)}},j=a.useCallback(async()=>{try{C(!0);const t={};h&&(t.search=h),m&&(t.priority=m),x&&(t.status=x),u&&(t.project=u);const r=await g.get("/tasks/tasks/my_tasks/",{params:t});w(r.data)}catch(t){console.error("Erreur lors du chargement des tâches",t),o("Erreur lors du chargement des tâches","danger")}finally{C(!1)}},[h,m,x,u]);a.useEffect(()=>{L.replace(),j(),G()},[j]),a.useEffect(()=>{L.replace()},[i,T]);const I=async()=>{if(N){try{await g.delete(`/tasks/tasks/${N.id}/`),o("Tâche supprimée avec succès","success"),w(i.filter(t=>t.id!==N.id))}catch(t){console.error(t),o("Erreur lors de la suppression","danger")}k(!1),q(null)}},J=async t=>{try{await g.post(`/tasks/tasks/${t}/mark_completed/`),o("Tâche marquée comme terminée","success"),j()}catch(r){console.error(r),o("Erreur lors de la modification","danger")}},K=async t=>{try{await g.post(`/tasks/tasks/${t}/mark_incomplete/`),o("Tâche marquée comme non terminée","success"),j()}catch(r){console.error(r),o("Erreur lors de la modification","danger")}},Q=t=>({high:"danger",medium:"warning",low:"success"})[t]||"secondary",U=t=>({done:"success",in_progress:"primary",todo:"secondary"})[t]||"secondary",W=t=>({high:"Haute",medium:"Moyenne",low:"Basse"})[t]||t,X=t=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[t]||t,P=t=>t?new Date(t).toLocaleDateString("fr-FR"):"Non définie",Y=(t,r)=>!t||r==="done"?!1:new Date(t)<new Date,Z=()=>{E(""),B(""),M(""),_("")};return e.jsx(te,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${s==="dark"?"text-light":"text-dark"}`,children:"Mes Tâches"}),e.jsx("p",{className:`mb-0 ${s==="dark"?"text-light":"text-muted"}`,children:"Gérez toutes vos tâches personnelles"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(d,{variant:"outline-secondary",as:p,to:"/employe/dashboard",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Dashboard"]}),e.jsxs(d,{variant:"outline-primary",as:p,to:"/employee/projects",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Mes Projets"]})]})]}),e.jsx(l,{className:`border-0 shadow-sm mb-4 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(l.Body,{children:e.jsxs(A,{className:"g-3",children:[e.jsxs(c,{md:3,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Recherche"}),e.jsx(n.Control,{type:"text",placeholder:"Rechercher par titre ou description...",value:h,onChange:t=>E(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs(c,{md:2,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Priorité"}),e.jsxs(n.Select,{value:m,onChange:t=>B(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Toutes"}),e.jsx("option",{value:"high",children:"Haute"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"low",children:"Basse"})]})]}),e.jsxs(c,{md:2,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Statut"}),e.jsxs(n.Select,{value:x,onChange:t=>M(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]})]}),e.jsxs(c,{md:3,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:"Projet"}),e.jsxs(n.Select,{value:u,onChange:t=>_(t.target.value),className:s==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous les projets"}),e.jsx("option",{value:"none",children:"Sans projet"}),T.map(t=>e.jsx("option",{value:t.id,children:t.title},t.id))]})]}),e.jsxs(c,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"primary",className:"w-100",onClick:j,children:[e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}}),"Filtrer"]})]}),e.jsxs(c,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"outline-secondary",className:"w-100",onClick:Z,children:[e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}}),"Réinitialiser"]})]})]})})}),e.jsxs(A,{className:"mb-4",children:[e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:`h5 mb-1 ${s==="dark"?"text-light":"text-dark"}`,children:i.length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Total"})]})})}),e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-success",children:i.filter(t=>t.status==="done").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Terminées"})]})})}),e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-primary",children:i.filter(t=>t.status==="in_progress").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"En Cours"})]})})}),e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-warning",children:i.filter(t=>t.status==="todo").length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"À Faire"})]})})}),e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-info",children:i.filter(t=>t.project).length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Avec Projet"})]})})}),e.jsx(c,{md:2,children:e.jsx(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(l.Body,{className:"text-center py-3",children:[e.jsx("div",{className:"h5 mb-1 text-secondary",children:i.filter(t=>!t.project).length}),e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:"Sans Projet"})]})})})]}),e.jsxs(l,{className:`border-0 shadow-sm ${s==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(l.Header,{className:`border-0 ${s==="dark"?"bg-dark":"bg-white"}`,children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"check-square",className:"me-2",style:{width:"20px",height:"20px"}}),"Mes Tâches (",i.length,")"]})})}),e.jsxs(l.Body,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(se,{hover:!0,className:`align-middle ${s==="dark"?"table-dark":""}`,children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Tâche"}),e.jsx("th",{className:"text-center",children:"Projet"}),e.jsx("th",{className:"text-center",children:"Priorité"}),e.jsx("th",{className:"text-center",children:"Statut"}),e.jsx("th",{children:"Échéance"}),e.jsx("th",{className:"text-center",children:"Créée le"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:i.map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${s==="dark"?"text-light":"text-dark"}`,children:t.title}),t.description&&e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:t.description.length>100?`${t.description.substring(0,100)}...`:t.description}),Y(t.due_date,t.status)&&e.jsx("div",{children:e.jsxs(f,{bg:"danger",className:"mt-1",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-1",style:{width:"10px",height:"10px"}}),"En retard"]})})]})}),e.jsx("td",{className:"text-center",children:t.project_title?e.jsx(f,{bg:"info",className:"cursor-pointer",as:p,to:`/employee/projects/${t.project}/tasks`,onClick:r=>r.stopPropagation(),title:t.project_title,children:t.project_title?t.project_title.length>10?t.project_title.substring(0,10)+"...":t.project_title:"Non spécifié"}):e.jsx("small",{className:"text-muted",children:"Aucun"})}),e.jsx("td",{className:"text-center",children:e.jsx(f,{bg:Q(t.priority),children:W(t.priority)})}),e.jsx("td",{className:"text-center",children:e.jsx(f,{bg:U(t.status),children:X(t.status)})}),e.jsx("td",{children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:P(t.due_date)})}),e.jsx("td",{className:"text-center",children:e.jsx("small",{className:s==="dark"?"text-light":"text-muted",children:P(t.created_at)})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-center gap-1",children:[e.jsx(d,{size:"sm",variant:"outline-info",as:p,to:`/employee/tasks/${t.id}`,title:"Voir les détails",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})}),t.status!=="done"?e.jsx(d,{size:"sm",variant:"outline-success",onClick:()=>J(t.id),title:"Marquer comme terminée",children:e.jsx("i",{"data-feather":"check-circle",style:{width:"14px",height:"14px"}})}):e.jsx(d,{size:"sm",variant:"outline-warning",onClick:()=>K(t.id),title:"Marquer comme non terminée",children:e.jsx("i",{"data-feather":"x-circle",style:{width:"14px",height:"14px"}})})]})})]},t.id))})]})}),i.length===0&&!S&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"check-square",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsx("h6",{className:s==="dark"?"text-light":"text-dark",children:"Aucune tâche trouvée"}),e.jsx("p",{className:s==="dark"?"text-light":"text-muted",children:h||m||x||u?"Aucune tâche ne correspond à vos critères de recherche.":"Vous n'avez pas encore de tâches."}),!(h||m||x||u)&&e.jsx(d,{variant:"primary",as:p,to:"/employee/tasks/create",children:"Créer ma première tâche"})]}),S&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Chargement..."})}),e.jsx("p",{className:"mt-2",children:"Chargement de vos tâches..."})]})]})]}),e.jsxs(b,{show:R,onHide:()=>k(!1),centered:!0,contentClassName:s==="dark"?"bg-dark text-light":"",children:[e.jsx(b.Header,{closeButton:!0,className:s==="dark"?"bg-dark border-secondary":"",children:e.jsx(b.Title,{children:"Confirmer la suppression"})}),e.jsxs(b.Body,{className:s==="dark"?"bg-dark":"",children:['Êtes-vous sûr de vouloir supprimer la tâche "',N?.title,'" ? Cette action est irréversible.']}),e.jsxs(b.Footer,{className:s==="dark"?"bg-dark border-secondary":"",children:[e.jsx(d,{variant:"secondary",onClick:()=>k(!1),children:"Annuler"}),e.jsx(d,{variant:"danger",onClick:I,children:"Supprimer"})]})]}),e.jsx(re,{position:"top-end",className:"p-3",children:e.jsxs(v,{show:H,onClose:()=>F(!1),delay:5e3,autohide:!0,bg:y,children:[e.jsx(v.Header,{className:y==="danger"?"bg-danger text-white":"",children:e.jsx("strong",{className:"me-auto",children:y==="success"?"Succès":"Erreur"})}),e.jsx(v.Body,{className:y==="danger"?"bg-danger text-white":"",children:z})]})})]})})}export{xe as default};
