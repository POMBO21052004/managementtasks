import{r as c,a as v,f as w,j as e,L as x}from"./index-hRRtG8yy.js";import{A as S}from"./Layout-Js2Zl1pA.js";import{B as d,a as r,R as _,C as i}from"./Row-bX7h-1jy.js";import{F as n}from"./Form-Dsmz1YOZ.js";import{T as L}from"./Table-qWWWCHOI.js";import{B as g}from"./NavBar-mvMqGCSV.js";import{P as R}from"./ProgressBar-Dqb3uvNn.js";import"./ElementChildren-NDIL728O.js";function O(){const[l,$]=c.useState([]),[k,N]=c.useState(!0),[t,b]=c.useState("light"),[h,f]=c.useState(""),[o,y]=c.useState("");c.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";b(s);const a=new MutationObserver(()=>{const p=document.documentElement.getAttribute("data-theme")||"light";b(p)});return a.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>a.disconnect()},[]);const j=c.useCallback(async()=>{try{N(!0);const s={};h&&(s.search=h),o&&(s.status=o);const a=await v.get("/tasks/projects/",{params:s}),p=a.data.results||a.data||[],B=(await Promise.all(p.map(async m=>{try{const u=await v.get(`/tasks/projects/${m.id}/my_tasks/`);return{...m,user_tasks:u.data||[],user_tasks_count:u.data.length||0,user_completed_tasks:u.data.filter(E=>E.status==="done").length||0}}catch{return{...m,user_tasks:[],user_tasks_count:0,user_completed_tasks:0}}}))).filter(m=>m.user_tasks_count>0);$(B)}catch(s){console.error("Erreur lors du chargement des projets",s)}finally{N(!1)}},[h,o]);c.useEffect(()=>{w.replace(),j()},[j]),c.useEffect(()=>{w.replace()},[l]);const T=s=>({active:"success",completed:"primary",archived:"secondary",on_hold:"warning"})[s]||"secondary",P=s=>({active:"Actif",completed:"Terminé",archived:"Archivé",on_hold:"En pause"})[s]||s,C=s=>s.user_tasks_count?Math.round(s.user_completed_tasks/s.user_tasks_count*100):0,A=s=>s>=80?"success":s>=50?"warning":"danger";return e.jsx(S,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:"Mes Projets"}),e.jsx("p",{className:`mb-0 ${t==="dark"?"text-light":"text-muted"}`,children:"Projets auxquels vous êtes assigné avec vos tâches"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(d,{variant:"outline-secondary",as:x,to:"/employe/dashboard",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Dashboard"]}),e.jsxs(d,{variant:"outline-primary",as:x,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Mes Tâches"]})]})]}),e.jsx(r,{className:`border-0 shadow-sm mb-4 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(r.Body,{children:e.jsxs(_,{className:"g-3",children:[e.jsxs(i,{md:6,children:[e.jsx(n.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Recherche"}),e.jsx(n.Control,{type:"text",placeholder:"Rechercher par titre de projet...",value:h,onChange:s=>f(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":""})]}),e.jsxs(i,{md:4,children:[e.jsx(n.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:"Statut"}),e.jsxs(n.Select,{value:o,onChange:s=>y(s.target.value),className:t==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Tous"}),e.jsx("option",{value:"active",children:"Actif"}),e.jsx("option",{value:"completed",children:"Terminé"}),e.jsx("option",{value:"on_hold",children:"En pause"})]})]}),e.jsxs(i,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"primary",className:"w-100",onClick:j,children:[e.jsx("i",{"data-feather":"filter",className:"me-1",style:{width:"14px",height:"14px"}}),"Filtrer"]})]}),e.jsxs(i,{md:1,children:[e.jsx(n.Label,{className:`small fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:" "}),e.jsxs(d,{variant:"outline-secondary",className:"w-100",onClick:()=>{f(""),y("")},children:[e.jsx("i",{"data-feather":"refresh-cw",className:"me-1",style:{width:"14px",height:"14px"}}),"Réinitialiser"]})]})]})})}),e.jsxs(r,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(r.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx("div",{className:"d-flex justify-content-between align-items-center",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"20px",height:"20px"}}),"Mes Projets (",l.length,")"]})})}),e.jsxs(r.Body,{children:[e.jsx("div",{className:"table-responsive",children:e.jsxs(L,{hover:!0,className:`align-middle ${t==="dark"?"table-dark":""}`,children:[e.jsx("thead",{className:"table-primary",children:e.jsxs("tr",{children:[e.jsx("th",{children:"Projet"}),e.jsx("th",{className:"text-center",children:"Mes Tâches"}),e.jsx("th",{className:"text-center",children:"Terminées"}),e.jsx("th",{className:"text-center",children:"Progression"}),e.jsx("th",{className:"text-center",children:"Statut Projet"}),e.jsx("th",{className:"text-center",children:"Actions"})]})}),e.jsx("tbody",{children:l.map(s=>{const a=C(s);return e.jsxs("tr",{children:[e.jsx("td",{children:e.jsxs("div",{children:[e.jsx("div",{className:`fw-bold ${t==="dark"?"text-light":"text-dark"}`,children:s.title}),s.description&&e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:s.description.length>100?`${s.description.substring(0,100)}...`:s.description})]})}),e.jsx("td",{className:"text-center",children:e.jsx(g,{bg:"primary",className:"fs-6",children:s.user_tasks_count})}),e.jsx("td",{className:"text-center",children:e.jsx(g,{bg:"success",className:"fs-6",children:s.user_completed_tasks})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex align-items-center justify-content-center",children:[e.jsx("div",{className:"flex-grow-1 me-2",style:{maxWidth:"100px"},children:e.jsx(R,{now:a,variant:A(a),style:{height:"8px"}})}),e.jsxs("small",{className:t==="dark"?"text-light":"text-dark",children:[a,"%"]})]})}),e.jsx("td",{className:"text-center",children:e.jsx(g,{bg:T(s.status),children:P(s.status)})}),e.jsx("td",{className:"text-center",children:e.jsxs("div",{className:"d-flex gap-1 justify-content-center",children:[e.jsx(d,{size:"sm",variant:"outline-primary",as:x,to:`/employee/projects/${s.id}/tasks`,title:"Voir mes tâches dans ce projet",children:e.jsx("i",{"data-feather":"list",style:{width:"14px",height:"14px"}})}),e.jsx(d,{size:"sm",variant:"outline-info",as:x,to:`/employee/projects/${s.id}`,title:"Voir les détails du projet",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})})]})})]},s.id)})})]})}),l.length===0&&!k&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("i",{"data-feather":"folder",className:"mb-3",style:{width:"48px",height:"48px",opacity:.5}}),e.jsx("h6",{className:t==="dark"?"text-light":"text-dark",children:"Aucun projet trouvé"}),e.jsx("p",{className:t==="dark"?"text-light":"text-muted",children:h||o?"Aucun projet ne correspond à vos critères de recherche.":"Vous n'êtes assigné à aucun projet pour le moment."}),e.jsxs(d,{variant:"outline-primary",as:x,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir toutes mes tâches"]})]}),k&&e.jsxs("div",{className:"text-center py-5",children:[e.jsx("div",{className:"spinner-border text-primary",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Chargement..."})}),e.jsx("p",{className:"mt-2",children:"Chargement de vos projets..."})]})]})]}),l.length>0&&e.jsxs(_,{className:"mt-4",children:[e.jsx(i,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("div",{className:`h4 mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:l.length}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Projets Assignés"})]})})}),e.jsx(i,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("div",{className:"h4 mb-1 text-primary",children:l.reduce((s,a)=>s+a.user_tasks_count,0)}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Total Tâches"})]})})}),e.jsx(i,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsx("div",{className:"h4 mb-1 text-success",children:l.reduce((s,a)=>s+a.user_completed_tasks,0)}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Tâches Terminées"})]})})}),e.jsx(i,{md:3,children:e.jsx(r,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs(r.Body,{className:"text-center",children:[e.jsxs("div",{className:"h4 mb-1 text-info",children:[Math.round(l.reduce((s,a)=>s+a.user_completed_tasks,0)/Math.max(1,l.reduce((s,a)=>s+a.user_tasks_count,0))*100),"%"]}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Taux d'Achèvement"})]})})})]})]})})}export{O as default};
