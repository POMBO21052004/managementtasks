import{d as G,u as K,r as n,f as Q,j as e,L as j,a as p}from"./index-hRRtG8yy.js";import{A as k}from"./Layout-Js2Zl1pA.js";import{S as W}from"./Spinner-CLl_Ort6.js";import{A as X}from"./Alert-CoKbwLKe.js";import{B as l,R as T,C as m,a}from"./Row-bX7h-1jy.js";import{B as x}from"./NavBar-mvMqGCSV.js";import{P as Y}from"./ProgressBar-Dqb3uvNn.js";import{M as g}from"./Modal-BDWqgiwM.js";import{T as Z,a as _}from"./ToastContainer-DioU2tZb.js";import"./ElementChildren-NDIL728O.js";function he(){const{id:h}=G(),M=K(),[s,f]=n.useState(null),[H,S]=n.useState(!0),[E,P]=n.useState(null),[c,$]=n.useState("light"),[O,D]=n.useState(!1),[L,z]=n.useState(""),[N,I]=n.useState("success"),[U,y]=n.useState(!1);n.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";$(t);const i=new MutationObserver(()=>{const A=document.documentElement.getAttribute("data-theme")||"light";$(A)});return i.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>i.disconnect()},[]);const u=(t,i="success")=>{z(t),I(i),D(!0)};n.useEffect(()=>{h&&(async()=>{try{S(!0);const i=await p.get(`/tasks/tasks/${h}/`);f(i.data)}catch(i){P("Erreur lors du chargement de la tâche"),console.error("Erreur:",i)}finally{S(!1)}})()},[h]),n.useEffect(()=>{Q.replace()},[s]);const q=async()=>{try{await p.delete(`/tasks/tasks/${h}/`),u("Tâche supprimée avec succès","success"),setTimeout(()=>{M("/employee/tasks")},1500)}catch(t){console.error(t),u("Erreur lors de la suppression","danger")}y(!1)},C=async()=>{try{await p.post(`/tasks/tasks/${h}/mark_completed/`);const t=await p.get(`/tasks/${h}/`);f(t.data),u("Tâche marquée comme terminée","success")}catch(t){console.error(t),u("Erreur lors de la modification","danger")}},B=async()=>{try{await p.post(`/tasks/tasks/${h}/mark_incomplete/`);const t=await p.get(`/tasks/${h}/`);f(t.data),u("Tâche marquée comme non terminée","success")}catch(t){console.error(t),u("Erreur lors de la modification","danger")}},b=t=>({high:"danger",medium:"warning",low:"success"})[t]||"secondary",R=t=>({done:"success",in_progress:"primary",todo:"secondary"})[t]||"secondary",w=t=>({high:"Haute",medium:"Moyenne",low:"Basse"})[t]||t,v=t=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[t]||t,o=t=>t?new Date(t).toLocaleDateString("fr-FR",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}):"Non définie",F=t=>!t||s?.status==="done"?!1:new Date(t)<new Date,J=t=>{if(!t)return null;const i=new Date,V=new Date(t)-i;return Math.ceil(V/(1e3*60*60*24))};if(H)return e.jsx(k,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(W,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des informations de la tâche..."})]})});if(E||!s)return e.jsxs(k,{children:[e.jsxs(X,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),E||"Tâche introuvable"]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(l,{variant:"secondary",as:j,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour à la liste"]}),e.jsxs(l,{variant:"primary",as:j,to:"/employe/dashboard",children:[e.jsx("i",{"data-feather":"home",className:"me-2"}),"Dashboard"]})]})]});const r=J(s.due_date),d=F(s.due_date);return e.jsxs(k,{children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsx("div",{children:e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(l,{variant:"outline-secondary",size:"sm",as:j,to:"/employee/tasks",className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-0 ${c==="dark"?"text-light":"text-dark"}`,children:s.title}),e.jsxs("div",{className:"d-flex align-items-center gap-2 mt-1",children:[e.jsxs(x,{bg:b(s.priority),className:"px-2 py-1",children:[e.jsx("i",{"data-feather":"flag",className:"me-1",style:{width:"12px",height:"12px"}}),w(s.priority)]}),e.jsxs(x,{bg:R(s.status),className:"px-2 py-1",children:[e.jsx("i",{"data-feather":s.status==="done"?"check-circle":"clock",className:"me-1",style:{width:"12px",height:"12px"}}),v(s.status)]}),d&&e.jsxs(x,{bg:"danger",className:"px-2 py-1",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-1",style:{width:"12px",height:"12px"}}),"En retard"]}),s.due_date&&!d&&s.status!=="done"&&e.jsxs(x,{bg:r<=3?"warning":"info",className:"px-2 py-1",children:[e.jsx("i",{"data-feather":"calendar",className:"me-1",style:{width:"12px",height:"12px"}}),r===0?"Aujourd'hui":r===1?"1 jour":`${r} jours`]})]})]})]})}),e.jsx("div",{className:"d-flex gap-2",children:s.status!=="done"?e.jsxs(l,{variant:"success",onClick:C,className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"check-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Marquer Terminée"]}):e.jsxs(l,{variant:"warning",onClick:B,className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Rouvrir"]})})]}),e.jsxs(T,{children:[e.jsxs(m,{lg:8,children:[e.jsxs(a,{className:`border-0 shadow-sm mb-4 ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"20px",height:"20px"}}),"Détails de la tâche"]})}),e.jsxs(a.Body,{children:[e.jsx(T,{className:"mb-4",children:e.jsxs(m,{md:12,children:[e.jsx("h4",{className:"mb-3",children:s.title}),s.description?e.jsx("div",{className:`p-3 rounded ${c==="dark"?"bg-dark border":"bg-light"}`,children:e.jsx("p",{className:"mb-0",style:{whiteSpace:"pre-wrap"},children:s.description})}):e.jsx("p",{className:"text-muted fst-italic",children:"Aucune description fournie"})]})}),e.jsx("hr",{className:"my-4"}),e.jsxs(T,{children:[e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Statut :"}),e.jsx(x,{bg:R(s.status),className:"fs-6",children:v(s.status)})]})}),e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Priorité :"}),e.jsx(x,{bg:b(s.priority),className:"fs-6",children:w(s.priority)})]})}),s.project_title&&e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Projet :"}),e.jsxs("div",{className:"text-end",children:[e.jsx("div",{className:"fw-medium",children:s.project_title}),e.jsxs(l,{variant:"outline-primary",size:"sm",as:j,to:`/employee/projects/${s.project}/tasks`,className:"mt-1",children:[e.jsx("i",{"data-feather":"folder",className:"me-1",style:{width:"12px",height:"12px"}}),"Voir le projet"]})]})]})}),e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Échéance :"}),e.jsxs("span",{className:`fw-medium ${d?"text-danger":""} d-flex align-items-center`,children:[s.due_date?o(s.due_date):"Non définie",d&&e.jsx("i",{"data-feather":"alert-triangle",className:"ms-1",style:{width:"14px",height:"14px"}})]})]})}),e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Terminée :"}),e.jsx(x,{bg:s.is_completed?"success":"secondary",className:"fs-6",children:s.is_completed?"Oui":"Non"})]})}),s.completed_at&&e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Terminée le :"}),e.jsx("span",{className:"fw-medium",children:o(s.completed_at)})]})}),e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Créée le :"}),e.jsx("span",{className:"fw-medium",children:o(s.created_at)})]})}),e.jsx(m,{md:6,className:"mb-3",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsx("span",{className:"text-muted",children:"Dernière modification :"}),e.jsx("span",{className:"fw-medium",children:o(s.updated_at)})]})})]}),s.due_date&&s.status!=="done"&&e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:"text-muted",children:"Progression vers l'échéance :"}),e.jsx("span",{className:`fw-medium ${d?"text-danger":r<=3?"text-warning":"text-success"}`,children:d?"En retard":r===0?"Échéance aujourd'hui":`${r} jour(s) restant(s)`})]}),e.jsx(Y,{now:d?100:Math.max(0,100-r*5),variant:d?"danger":r<=3?"warning":"success",style:{height:"8px"}})]})]})]}),e.jsxs(a,{className:`border-0 shadow-sm ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"zap",className:"me-2",style:{width:"20px",height:"20px"}}),"Actions Rapides"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"row g-2",children:[e.jsx("div",{className:"col-md-4",children:e.jsxs(l,{variant:s.status==="done"?"warning":"success",onClick:s.status==="done"?B:C,className:"w-100 d-flex align-items-center justify-content-center",children:[e.jsx("i",{"data-feather":s.status==="done"?"x-circle":"check-circle",className:"me-2",style:{width:"16px",height:"16px"}}),s.status==="done"?"Rouvrir":"Terminer"]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs(l,{variant:"primary",as:j,to:`/employee/tasks/${h}/edit`,className:"w-100 d-flex align-items-center justify-content-center",children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"16px",height:"16px"}}),"Modifier"]})}),e.jsx("div",{className:"col-md-4",children:e.jsxs(l,{variant:"outline-secondary",as:j,to:"/employee/tasks",className:"w-100 d-flex align-items-center justify-content-center",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes mes tâches"]})})]})})]})]}),e.jsxs(m,{lg:4,children:[s.project&&e.jsxs(a,{className:`border-0 shadow-sm mb-4 ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"20px",height:"20px"}}),"Projet associé"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"bg-primary bg-opacity-10 rounded-circle p-3 d-inline-flex mb-3",children:e.jsx("i",{"data-feather":"folder",className:"text-primary",style:{width:"32px",height:"32px"}})}),e.jsx("h6",{className:"mb-1",children:s.project_title}),e.jsxs(l,{variant:"outline-primary",size:"sm",as:j,to:`/employee/projects/${s.project}/tasks`,className:"mt-2",children:[e.jsx("i",{"data-feather":"list",className:"me-1",style:{width:"14px",height:"14px"}}),"Voir toutes les tâches du projet"]})]})})]}),e.jsxs(a,{className:`border-0 shadow-sm mb-4 ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-primary",style:{width:"20px",height:"20px"}}),"Statut de la Tâche"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`rounded-circle p-4 d-inline-flex mb-3 ${s.status==="done"?"bg-success":s.status==="in_progress"?"bg-primary":"bg-secondary"}`,children:e.jsx("i",{"data-feather":s.status==="done"?"check-circle":s.status==="in_progress"?"play-circle":"clock",className:"text-white",style:{width:"48px",height:"48px"}})}),e.jsx("h4",{className:s.status==="done"?"text-success":s.status==="in_progress"?"text-primary":"text-secondary",children:v(s.status)}),e.jsx("hr",{className:"my-3"}),e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Priorité :"}),e.jsx(x,{bg:b(s.priority),children:w(s.priority)})]}),e.jsxs("div",{className:"d-flex justify-content-between mb-2",children:[e.jsx("span",{className:"text-muted",children:"Terminée :"}),e.jsx(x,{bg:s.is_completed?"success":"secondary",children:s.is_completed?"Oui":"Non"})]}),s.due_date&&e.jsxs("div",{className:"d-flex justify-content-between",children:[e.jsx("span",{className:"text-muted",children:"Échéance :"}),e.jsx("span",{className:d?"text-danger fw-bold":r<=3?"text-warning":"text-muted",children:o(s.due_date)})]})]})]})})]}),s.due_date&&e.jsxs(a,{className:`border-0 shadow-sm mb-4 ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"calendar",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"Délai d'Échéance"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:`display-4 fw-bold mb-2 ${d?"text-danger":r<=3?"text-warning":"text-success"}`,children:d?"!":r}),e.jsx("h6",{className:d?"text-danger":r<=3?"text-warning":"text-success",children:d?"TÂCHE EN RETARD":r===0?"ÉCHÉANCE AUJOURD'HUI":r===1?"JOUR RESTANT":"JOURS RESTANTS"}),e.jsx("small",{className:"text-muted",children:o(s.due_date)})]})})]}),e.jsxs(a,{className:`border-0 shadow-sm ${c==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"database",className:"me-2 text-secondary",style:{width:"20px",height:"20px"}}),"Informations Système"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"hash",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"ID Tâche"}),e.jsx("div",{className:"text-muted",children:s.id})]})]}),e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"calendar",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Date de création"}),e.jsx("div",{className:"text-muted",children:o(s.created_at)})]})]}),e.jsxs("div",{className:"d-flex align-items-start mb-3",children:[e.jsx("i",{"data-feather":"clock",className:"text-secondary me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Dernière modification"}),e.jsx("div",{className:"text-muted",children:o(s.updated_at)})]})]}),s.completed_at&&e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"check-circle",className:"text-success me-2 mt-1",style:{width:"16px",height:"16px"}}),e.jsxs("div",{children:[e.jsx("div",{className:"fw-medium",children:"Date d'achèvement"}),e.jsx("div",{className:"text-muted",children:o(s.completed_at)})]})]})]})})]})]})]}),e.jsxs(g,{show:U,onHide:()=>y(!1),centered:!0,contentClassName:c==="dark"?"bg-dark text-light":"",children:[e.jsx(g.Header,{className:c==="dark"?"bg-dark text-light border-secondary":"",closeButton:!0,children:e.jsx(g.Title,{children:"Confirmation de Suppression"})}),e.jsxs(g.Body,{className:c==="dark"?"bg-dark text-light":"",children:[e.jsx("p",{children:"Êtes-vous sûr de vouloir supprimer cette tâche ?"}),e.jsxs("div",{className:"alert alert-warning",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2",style:{width:"16px",height:"16px"}}),'Cette action est irréversible. La tâche "',s.title,'" sera définitivement supprimée.']})]}),e.jsxs(g.Footer,{className:c==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx(l,{variant:"secondary",onClick:()=>y(!1),children:"Annuler"}),e.jsxs(l,{variant:"danger",onClick:q,children:[e.jsx("i",{"data-feather":"trash-2",className:"me-2",style:{width:"16px",height:"16px"}}),"Supprimer définitivement"]})]})]}),e.jsx(Z,{position:"bottom-end",className:"p-3 position-fixed",style:{zIndex:1050},children:e.jsxs(_,{show:O,onClose:()=>D(!1),delay:3e3,autohide:!0,bg:N==="success"?"success":"danger",className:c==="dark"?"text-light":"text-white",children:[e.jsx(_.Header,{closeButton:!1,className:`${N==="success"?"bg-success text-white":"bg-danger text-white"}`,children:e.jsxs("strong",{className:"me-auto",children:[e.jsx("i",{"data-feather":N==="success"?"check-circle":"x-circle",className:"me-2",style:{width:"16px",height:"16px"}}),"Notification"]})}),e.jsx(_.Body,{className:c==="dark"?"bg-dark text-light":"",children:L})]})})]})}export{he as default};
