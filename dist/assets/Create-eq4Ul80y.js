import{u as T,c as $,r as i,f as S,j as e,L as E,a as A}from"./index-K0TI1Cn5.js";import{A as I}from"./Layout-Dp7EFE9w.js";import{B as f,R as p,C as d,a as c}from"./Row-DpO6zsT4.js";import{A as G}from"./Alert-JqR1u8An.js";import{F as s}from"./Form-CAmGkuOD.js";import{B as _}from"./NavBar-BemxVd0Z.js";import{S as L}from"./Spinner-Br6_VxcD.js";import"./ElementChildren-DHcghUFE.js";function J(){const D=T(),j=$(),[u,y]=i.useState(!1),[N,v]=i.useState(null),[o,m]=i.useState({}),[a,k]=i.useState("light"),[l,F]=i.useState([]),[g,w]=i.useState(!0),[n,C]=i.useState({title:"",description:"",priority:"medium",status:"todo",due_date:"",project:""});i.useEffect(()=>{const t=document.documentElement.getAttribute("data-theme")||"light";k(t);const r=new MutationObserver(()=>{const x=document.documentElement.getAttribute("data-theme")||"light";k(x)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]);const B=async()=>{try{w(!0);const t=await A.get("/tasks/projects/");F(t.data.results||t.data||[])}catch(t){console.error("Erreur lors du chargement des projets",t)}finally{w(!1)}};i.useEffect(()=>{S.replace(),B(),j.state?.project_id&&C(t=>({...t,project:j.state.project_id}))},[j]),i.useEffect(()=>{S.replace()},[l,g]);const h=t=>{const{name:r,value:x}=t.target;C(b=>({...b,[r]:x})),o[r]&&m(b=>({...b,[r]:null}))},P=async t=>{if(t.preventDefault(),!n.title.trim()){m({title:["Le titre est obligatoire"]});return}try{y(!0),v(null),m({});const r={...n,project:n.project||null};(await A.post("/tasks/tasks/",r)).data&&D("/employee/tasks",{state:{message:"T√¢che cr√©√©e avec succ√®s ‚úÖ",type:"success"}})}catch(r){console.error("‚ùå Erreur cr√©ation t√¢che:",r),r.response?.data?.errors?m(r.response.data.errors):v(r.response?.data?.message||"Erreur lors de la cr√©ation de la t√¢che")}finally{y(!1)}};return e.jsx(I,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${a==="dark"?"text-light":"text-dark"}`,children:"Cr√©er une nouvelle t√¢che"}),e.jsx("p",{className:`mb-0 ${a==="dark"?"text-light":"text-muted"}`,children:"Cr√©ation d'une nouvelle t√¢che personnelle"})]}),e.jsxs(f,{variant:"outline-secondary",as:E,to:"/employee/tasks",className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2",style:{width:"16px",height:"16px"}}),"Retour"]})]}),N&&e.jsxs(G,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),e.jsx("strong",{children:"Erreur:"})," ",N]}),e.jsx(s,{onSubmit:P,children:e.jsxs(p,{children:[e.jsx(d,{lg:8,className:"mb-4",children:e.jsxs(c,{className:`border-0 shadow-sm ${a==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(c.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"plus-circle",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations de la t√¢che"]})}),e.jsxs(c.Body,{children:[e.jsx(p,{children:e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Projet (optionnel)",Array.isArray(l)&&l.length>0&&e.jsxs(_,{bg:"primary",className:"ms-2",children:[l.length," projet(s)"]})]}),g?e.jsxs("div",{className:"d-flex align-items-center p-3 border rounded",children:[e.jsx(L,{animation:"border",size:"sm",className:"me-2"}),e.jsx("span",{className:"text-muted",children:"Chargement des projets..."})]}):!Array.isArray(l)||l.length===0?e.jsx("div",{className:"p-3 border border-info rounded bg-info bg-opacity-10",children:e.jsxs("div",{className:"text-info",children:[e.jsx("i",{"data-feather":"folder",className:"me-2"}),"Aucun projet disponible"]})}):e.jsxs(s.Select,{name:"project",value:n.project,onChange:h,isInvalid:!!o.project,className:a==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Aucun projet (t√¢che ind√©pendante)"}),l.map(t=>e.jsxs("option",{value:t.id,children:[t.title,t.status!=="active"&&` [${t.status}]`]},t.id))]}),e.jsx(s.Control.Feedback,{type:"invalid",children:o.project?.[0]})]})})}),e.jsx("hr",{className:"my-3"}),e.jsxs(p,{children:[e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"type",className:"me-2",style:{width:"16px",height:"16px"}}),"Titre de la t√¢che *"]}),e.jsx(s.Control,{type:"text",name:"title",value:n.title,onChange:h,placeholder:"Ex: D√©veloppement de la fonctionnalit√© X",isInvalid:!!o.title,className:a==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(s.Control.Feedback,{type:"invalid",children:o.title?.[0]})]})}),e.jsx(d,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"16px",height:"16px"}}),"Description"]}),e.jsx(s.Control,{as:"textarea",rows:4,name:"description",value:n.description,onChange:h,placeholder:"D√©crivez en d√©tail la t√¢che √† accomplir...",isInvalid:!!o.description,className:a==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(s.Control.Feedback,{type:"invalid",children:o.description?.[0]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"16px",height:"16px"}}),"Priorit√©"]}),e.jsxs(s.Select,{name:"priority",value:n.priority,onChange:h,className:a==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"low",children:"üü¢ Basse"}),e.jsx("option",{value:"medium",children:"üü° Moyenne"}),e.jsx("option",{value:"high",children:"üî¥ Haute"})]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"activity",className:"me-2",style:{width:"16px",height:"16px"}}),"Statut initial"]}),e.jsxs(s.Select,{name:"status",value:n.status,onChange:h,className:a==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"todo",children:"‚è≥ √Ä faire"}),e.jsx("option",{value:"in_progress",children:"üîÑ En cours"}),e.jsx("option",{value:"done",children:"‚úÖ Termin√©e"})]})]})}),e.jsx(d,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"calendar",className:"me-2",style:{width:"16px",height:"16px"}}),"Date d'√©ch√©ance"]}),e.jsx(s.Control,{type:"date",name:"due_date",value:n.due_date,onChange:h,min:new Date().toISOString().split("T")[0],className:a==="dark"?"bg-dark text-light border-secondary":""})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(p,{children:e.jsx(d,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(f,{variant:"outline-secondary",as:E,to:"/employee/tasks",className:"me-2",disabled:u,children:"Annuler"}),e.jsx(f,{variant:"success",type:"submit",disabled:u,className:"d-flex align-items-center",children:u?e.jsxs(e.Fragment,{children:[e.jsx(L,{animation:"border",size:"sm",className:"me-2"}),"Cr√©ation..."]}):e.jsx(e.Fragment,{children:"Cr√©er la t√¢che"})})]})})})]})]})}),e.jsxs(d,{lg:4,children:[e.jsxs(c,{className:`border-0 shadow-sm mb-4 ${a==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(c.Header,{className:`border-0 ${a==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-primary",style:{width:"20px",height:"20px"}}),"Informations"]})}),e.jsx(c.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-secondary me-2",style:{width:"14px",height:"14px"}}),e.jsxs("span",{children:["Projets charg√©s: ",e.jsx("strong",{children:Array.isArray(l)?l.length:0})]})]}),e.jsxs("div",{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"database",className:"text-secondary me-2",style:{width:"14px",height:"14px"}}),e.jsxs("span",{children:["Statut: ",g?"Chargement...":"Pr√™t"]})]})]})})]}),e.jsxs(c,{className:`border-0 shadow-sm mb-4 ${a==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(c.Header,{className:`border-0 ${a==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"help-circle",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"√Ä propos des projets"]})}),e.jsx(c.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les projets permettent d'organiser les t√¢ches par contexte"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"link",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Une t√¢che peut √™tre ind√©pendante ou li√©e √† un projet"})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"bar-chart",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les statistiques par projet aident au suivi global"})]})]})})]})]})]})})]})})}export{J as default};
