import{d as G,u as M,r as c,f as H,j as e,L as j,a as k}from"./index-K0TI1Cn5.js";import{A as w}from"./Layout-Dp7EFE9w.js";import{S as z}from"./Spinner-Br6_VxcD.js";import{A as D}from"./Alert-JqR1u8An.js";import{B as p,R as g,C as m,a as o}from"./Row-DpO6zsT4.js";import{F as s}from"./Form-CAmGkuOD.js";import{B as q}from"./NavBar-BemxVd0Z.js";import"./ElementChildren-DHcghUFE.js";function Z(){const{id:h}=G(),F=M(),[n,$]=c.useState(null),[f,T]=c.useState([]),[A,C]=c.useState(!0),[b,_]=c.useState(!1),[u,y]=c.useState(null),[l,N]=c.useState({}),[r,S]=c.useState("light"),[V,E]=c.useState(!0),[d,L]=c.useState({title:"",description:"",priority:"medium",status:"todo",due_date:"",project:"",is_completed:!1});c.useEffect(()=>{const a=document.documentElement.getAttribute("data-theme")||"light";S(a);const t=new MutationObserver(()=>{const i=document.documentElement.getAttribute("data-theme")||"light";S(i)});return t.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>t.disconnect()},[]);const B=async()=>{try{E(!0);const a=await k.get("/tasks/projects/");T(a.data.results||a.data||[])}catch(a){console.error("Erreur lors du chargement des projets",a)}finally{E(!1)}};c.useEffect(()=>{h&&((async()=>{try{C(!0);const i=(await k.get(`/tasks/tasks/${h}/`)).data;$(i),L({title:i.title||"",description:i.description||"",priority:i.priority||"medium",status:i.status||"todo",due_date:i.due_date?i.due_date.split("T")[0]:"",project:i.project||"",is_completed:i.is_completed||!1})}catch(t){y("Erreur lors du chargement des données"),console.error("Erreur:",t)}finally{C(!1)}})(),B())},[h]),c.useEffect(()=>{H.replace()},[n,f]);const x=a=>{const{name:t,value:i,type:P,checked:R}=a.target;L(v=>({...v,[t]:P==="checkbox"?R:i})),l[t]&&N(v=>({...v,[t]:null}))},I=async a=>{a.preventDefault();try{_(!0),y(null),N({});const t={...d,project:d.project||null,status:d.is_completed?"done":d.status};(await k.put(`/tasks/tasks/${h}/`,t)).data&&F(`/employee/tasks/${h}`)}catch(t){t.response?.data?.errors?N(t.response.data.errors):y(t.response?.data?.message||"Erreur lors de la mise à jour")}finally{_(!1)}};return A?e.jsx(w,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(z,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement des données..."})]})}):u&&!n?e.jsxs(w,{children:[e.jsxs(D,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),u]}),e.jsx("div",{className:"d-flex gap-2",children:e.jsxs(p,{variant:"secondary",as:j,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-2"}),"Retour à la liste"]})})]}):e.jsxs(w,{children:[e.jsx("div",{className:"d-flex justify-content-between align-items-center mb-4",children:e.jsxs("div",{children:[e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsxs(p,{variant:"outline-secondary",size:"sm",as:j,to:`/employee/tasks/${h}`,className:"me-3",children:[e.jsx("i",{"data-feather":"arrow-left",className:"me-1",style:{width:"16px",height:"16px"}}),"Retour"]}),e.jsx("h1",{className:"h3 mb-0",children:"Modifier la tâche"})]}),e.jsxs("p",{className:"text-muted mb-0",children:["Modification de la tâche : ",n?.title]})]})}),u&&e.jsxs(D,{variant:"danger",className:"mb-4",children:[e.jsx("i",{"data-feather":"alert-circle",className:"me-2"}),u]}),e.jsx(s,{onSubmit:I,children:e.jsxs(g,{children:[e.jsx(m,{lg:8,className:"mb-4",children:e.jsxs(o,{className:`border-0 shadow-sm ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:"border-0",children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"edit",className:"me-2",style:{width:"20px",height:"20px"}}),"Informations de la tâche"]})}),e.jsxs(o.Body,{children:[e.jsx(g,{children:e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{className:"d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Projet (optionnel)",e.jsxs(q,{bg:"primary",className:"ms-2",children:[f.length," projet(s)"]})]}),e.jsxs(s.Select,{name:"project",value:d.project,onChange:x,isInvalid:!!l.project,className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"",children:"Aucun projet (tâche indépendante)"}),f.map(a=>e.jsxs("option",{value:a.id,children:[a.title,a.status!=="active"&&` [${a.status}]`]},a.id))]}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.project?.[0]})]})})}),e.jsx("hr",{className:"my-3"}),e.jsxs(g,{children:[e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"type",className:"me-2",style:{width:"16px",height:"16px"}}),"Titre de la tâche *"]}),e.jsx(s.Control,{type:"text",name:"title",value:d.title,onChange:x,placeholder:"Titre de la tâche",isInvalid:!!l.title,className:r==="dark"?"bg-dark text-light border-secondary":"",required:!0}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.title?.[0]})]})}),e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"file-text",className:"me-2",style:{width:"16px",height:"16px"}}),"Description"]}),e.jsx(s.Control,{as:"textarea",rows:4,name:"description",value:d.description,onChange:x,placeholder:"Description détaillée de la tâche...",isInvalid:!!l.description,className:r==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.description?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"16px",height:"16px"}}),"Priorité"]}),e.jsxs(s.Select,{name:"priority",value:d.priority,onChange:x,isInvalid:!!l.priority,className:r==="dark"?"bg-dark text-light border-secondary":"",children:[e.jsx("option",{value:"low",children:"Basse"}),e.jsx("option",{value:"medium",children:"Moyenne"}),e.jsx("option",{value:"high",children:"Haute"})]}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.priority?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"activity",className:"me-2",style:{width:"16px",height:"16px"}}),"Statut"]}),e.jsxs(s.Select,{name:"status",value:d.status,onChange:x,isInvalid:!!l.status,className:r==="dark"?"bg-dark text-light border-secondary":"",disabled:d.is_completed,children:[e.jsx("option",{value:"todo",children:"À faire"}),e.jsx("option",{value:"in_progress",children:"En cours"}),e.jsx("option",{value:"done",children:"Terminée"})]}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.status?.[0]})]})}),e.jsx(m,{md:4,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsxs(s.Label,{children:[e.jsx("i",{"data-feather":"calendar",className:"me-2",style:{width:"16px",height:"16px"}}),"Date d'échéance"]}),e.jsx(s.Control,{type:"date",name:"due_date",value:d.due_date,onChange:x,isInvalid:!!l.due_date,className:r==="dark"?"bg-dark text-light border-secondary":""}),e.jsx(s.Control.Feedback,{type:"invalid",children:l.due_date?.[0]})]})}),e.jsx(m,{md:12,className:"mb-3",children:e.jsxs(s.Group,{children:[e.jsx(s.Label,{children:"État d'achèvement"}),e.jsxs("div",{children:[e.jsx(s.Check,{type:"checkbox",name:"is_completed",label:"Tâche terminée",checked:d.is_completed,onChange:x,className:r==="dark"?"text-light":""}),e.jsx(s.Text,{className:"text-muted",children:"Cochez cette case si la tâche est complétée"})]})]})})]}),e.jsx("hr",{className:"my-4"}),e.jsx(g,{children:e.jsx(m,{md:12,children:e.jsxs("div",{className:"d-flex justify-content-end",children:[e.jsx(p,{variant:"outline-secondary",as:j,to:`/employee/tasks/${h}`,className:"me-2",disabled:b,children:"Annuler"}),e.jsx(p,{variant:"primary",type:"submit",disabled:b,className:"d-flex align-items-center",children:b?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"spinner-border spinner-border-sm me-2",role:"status",children:e.jsx("span",{className:"visually-hidden",children:"Loading..."})}),"Mise à jour..."]}):e.jsx(e.Fragment,{children:"Enregistrer les Modifications"})})]})})})]})]})}),e.jsxs(m,{lg:4,children:[n&&e.jsxs(o,{className:`border-0 shadow-sm mb-4 ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"info",className:"me-2 text-success",style:{width:"20px",height:"20px"}}),"Informations actuelles"]})}),e.jsxs(o.Body,{children:[e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Créée le"}),e.jsx("span",{className:"small",children:new Date(n.created_at).toLocaleDateString("fr-FR")})]}),e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Dernière modification"}),e.jsx("span",{className:"small",children:new Date(n.updated_at).toLocaleDateString("fr-FR")})]}),n.project_title&&e.jsxs("div",{className:"d-flex align-items-center justify-content-between mb-2",children:[e.jsx("span",{className:"small",children:"Projet"}),e.jsx("span",{className:"small fw-bold",children:n.project_title})]}),n.completed_at&&e.jsxs("div",{className:"d-flex align-items-center justify-content-between",children:[e.jsx("span",{className:"small",children:"Terminée le"}),e.jsx("span",{className:"small",children:new Date(n.completed_at).toLocaleDateString("fr-FR")})]})]})]}),e.jsxs(o,{className:`border-0 shadow-sm mb-4 ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"help-circle",className:"me-2 text-info",style:{width:"20px",height:"20px"}}),"Conseils"]})}),e.jsx(o.Body,{children:e.jsxs("div",{className:"small",children:[e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"folder",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les projets aident à organiser les tâches par contexte"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"flag",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Utilisez les priorités pour organiser le travail"})]}),e.jsxs("div",{className:"d-flex align-items-start mb-2",children:[e.jsx("i",{"data-feather":"calendar",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Les dates d'échéance aident à suivre les délais"})]}),e.jsxs("div",{className:"d-flex align-items-start",children:[e.jsx("i",{"data-feather":"check-circle",className:"text-primary me-2 mt-1",style:{width:"14px",height:"14px"}}),e.jsx("span",{children:"Marquez comme terminée pour suivre la progression"})]})]})})]}),e.jsxs(o,{className:`border-0 shadow-sm ${r==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(o.Header,{className:`border-0 ${r==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"settings",className:"me-2 text-warning",style:{width:"20px",height:"20px"}}),"Actions supplémentaires"]})}),e.jsx(o.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(p,{variant:"outline-info",as:j,to:`/employee/tasks/${h}`,children:[e.jsx("i",{"data-feather":"eye",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir la tâche"]}),n?.project&&e.jsxs(p,{variant:"outline-primary",as:j,to:`/employee/projects/${n.project}/tasks`,children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Voir le projet"]}),e.jsxs(p,{variant:"outline-secondary",as:j,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes mes tâches"]})]})})]})]})]})})]})}export{Z as default};
