import{b as G,r as h,f as $,j as e,L as c,a as g}from"./index-K0TI1Cn5.js";import{A as T}from"./Layout-Dp7EFE9w.js";import{S as I}from"./Spinner-Br6_VxcD.js";import{B as n,R as u,C as l,a}from"./Row-DpO6zsT4.js";import{P as B}from"./ProgressBar-Dzhpx0Dl.js";import{B as m}from"./NavBar-BemxVd0Z.js";import"./ElementChildren-DHcghUFE.js";function ae(){const{user:J}=G(),[i,P]=h.useState(null),[y,S]=h.useState(null),[p,E]=h.useState([]),[b,R]=h.useState([]),[A,f]=h.useState(!0),[t,k]=h.useState("light");h.useEffect(()=>{const s=document.documentElement.getAttribute("data-theme")||"light";k(s);const r=new MutationObserver(()=>{const N=document.documentElement.getAttribute("data-theme")||"light";k(N)});return r.observe(document.documentElement,{attributes:!0,attributeFilter:["data-theme"]}),()=>r.disconnect()},[]);const C=async()=>{try{f(!0);const s=await g.get("/tasks/tasks/statistics/");P(s.data);const r=await g.get("/tasks/projects/"),N=r.data.results||r.data||[],x=(await Promise.all(N.map(async d=>{try{const _=(await g.get(`/tasks/projects/${d.id}/my_tasks/`)).data||[];return{...d,user_tasks_count:_.length,user_completed_tasks:_.filter(q=>q.status==="done").length}}catch{return{...d,user_tasks_count:0,user_completed_tasks:0}}}))).filter(d=>d.user_tasks_count>0);R(x);const W={total_projects:x.length,total_tasks_in_projects:x.reduce((d,o)=>d+o.user_tasks_count,0),completed_tasks_in_projects:x.reduce((d,o)=>d+o.user_completed_tasks,0),active_projects:x.filter(d=>d.status==="active").length};S(W);const O=await g.get("/tasks/tasks/my_tasks/");E(O.data.slice(0,5))}catch(s){console.error("Erreur lors du chargement du dashboard",s)}finally{f(!1)}};h.useEffect(()=>{$.replace(),C()},[]),h.useEffect(()=>{$.replace()},[i,p,b]);const M=s=>({high:"danger",medium:"warning",low:"success"})[s]||"secondary",V=s=>({done:"success",in_progress:"primary",todo:"secondary"})[s]||"secondary",D=s=>({active:"success",completed:"primary",archived:"secondary",on_hold:"warning"})[s]||"secondary",z=s=>({high:"Haute",medium:"Moyenne",low:"Basse"})[s]||s,H=s=>({done:"Terminée",in_progress:"En cours",todo:"À faire"})[s]||s,L=s=>({active:"Actif",completed:"Terminé",archived:"Archivé",on_hold:"En pause"})[s]||s,w=s=>s?new Date(s).toLocaleDateString("fr-FR"):"Non définie",U=(s,r)=>!s||r==="done"?!1:new Date(s)<new Date,j=()=>!i||!i.total?0:Math.round(i.completed/i.total*100),F=s=>s.user_tasks_count?Math.round(s.user_completed_tasks/s.user_tasks_count*100):0,v=s=>s>=80?"success":s>=50?"warning":"danger";return A?e.jsx(T,{children:e.jsxs("div",{className:"text-center py-5",children:[e.jsx(I,{animation:"border",variant:"primary"}),e.jsx("p",{className:"mt-2",children:"Chargement de votre dashboard..."})]})}):e.jsx(T,{children:e.jsxs("div",{className:"container-fluid py-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:`h3 mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:"Mon Tableau de Bord"}),e.jsx("p",{className:`mb-0 ${t==="dark"?"text-light":"text-muted"}`,children:"Vue d'ensemble de vos tâches, projets et activités"})]}),e.jsxs("div",{className:"d-flex gap-2",children:[e.jsxs(n,{variant:"outline-primary",as:c,to:"/employee/projects",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Mes Projets"]}),e.jsxs(n,{variant:"primary",as:c,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Mes Tâches"]})]})]}),e.jsxs(u,{className:"mb-4",children:[e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:`mb-0 ${t==="dark"?"text-light":"text-dark"}`,children:i?.total||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Total Tâches"})]}),e.jsx("div",{className:"text-primary",children:e.jsx("i",{"data-feather":"check-square",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-success",children:i?.completed||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Terminées"})]}),e.jsx("div",{className:"text-success",children:e.jsx("i",{"data-feather":"check-circle",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-warning",children:i?.pending||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"En Attente"})]}),e.jsx("div",{className:"text-warning",children:e.jsx("i",{"data-feather":"clock",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-info",children:y?.total_projects||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Projets"})]}),e.jsx("div",{className:"text-info",children:e.jsx("i",{"data-feather":"folder",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"mb-0 text-purple",children:y?.total_tasks_in_projects||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Tâches Projets"})]}),e.jsx("div",{className:"text-purple",children:e.jsx("i",{"data-feather":"list",style:{width:"24px",height:"24px"}})})]})})})}),e.jsx(l,{md:2,children:e.jsx(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsx(a.Body,{className:"text-center",children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"mb-0 text-orange",children:[j(),"%"]}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Achèvement"})]}),e.jsx("div",{className:"text-orange",children:e.jsx("i",{"data-feather":"target",style:{width:"24px",height:"24px"}})})]})})})})]}),e.jsxs(u,{className:"mb-4",children:[e.jsx(l,{md:6,children:e.jsxs(a,{className:`border-0 shadow-sm h-100 ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"bar-chart",className:"me-2",style:{width:"20px",height:"20px"}}),"Progression des Tâches"]})}),e.jsxs(a.Body,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"d-flex justify-content-between align-items-center mb-2",children:[e.jsx("span",{className:t==="dark"?"text-light":"text-dark",children:"Taux d'achèvement global"}),e.jsxs("strong",{className:t==="dark"?"text-light":"text-dark",children:[j(),"%"]})]}),e.jsx(B,{now:j(),variant:v(j()),style:{height:"12px"}})]}),e.jsxs(u,{className:"text-center",children:[e.jsx(l,{md:4,children:e.jsxs("div",{className:"border-end border-secondary",children:[e.jsx("div",{className:`h4 mb-1 ${t==="dark"?"text-light":"text-dark"}`,children:i?.by_status?.todo||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"À Faire"})]})}),e.jsx(l,{md:4,children:e.jsxs("div",{className:"border-end border-secondary",children:[e.jsx("div",{className:`h4 mb-1 text-primary ${t==="dark"?"text-light":"text-dark"}`,children:i?.by_status?.in_progress||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"En Cours"})]})}),e.jsxs(l,{md:4,children:[e.jsx("div",{className:`h4 mb-1 text-success ${t==="dark"?"text-light":"text-dark"}`,children:i?.by_status?.done||0}),e.jsx("small",{className:t==="dark"?"text-light":"text-muted",children:"Terminées"})]})]})]})]})}),e.jsx(l,{md:6,children:e.jsxs(a,{className:`border-0 shadow-sm h-100 ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"20px",height:"20px"}}),"Mes Projets"]}),e.jsx(n,{variant:"outline-primary",size:"sm",as:c,to:"/employee/projects",children:"Voir tout"})]})}),e.jsx(a.Body,{children:b.length>0?e.jsx("div",{className:"list-group list-group-flush",children:b.slice(0,4).map(s=>{const r=F(s);return e.jsx("div",{className:`list-group-item list-group-item-action border-0 ${t==="dark"?"bg-dark text-light":""}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center mb-1",children:[e.jsx("h6",{className:`mb-0 me-2 ${t==="dark"?"text-light":"text-dark"}`,children:s.title}),e.jsx(m,{bg:D(s.status),className:"me-2",children:L(s.status)}),e.jsxs(m,{bg:"primary",children:[s.user_tasks_count," tâche(s)"]})]}),e.jsxs("div",{className:"d-flex align-items-center mb-2",children:[e.jsx("div",{className:"flex-grow-1 me-2",style:{maxWidth:"100px"},children:e.jsx(B,{now:r,variant:v(r),style:{height:"6px"}})}),e.jsxs("small",{className:t==="dark"?"text-light":"text-dark",children:[r,"%"]})]}),e.jsxs("div",{className:"small text-muted",children:[s.user_completed_tasks," sur ",s.user_tasks_count," tâches terminées"]})]}),e.jsx("div",{className:"d-flex gap-1 ms-3",children:e.jsx(n,{size:"sm",variant:"outline-primary",as:c,to:`/employee/projects/${s.id}`,title:"Voir le projet",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})})})]})},s.id)})}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{"data-feather":"folder",className:"text-muted mb-3",style:{width:"48px",height:"48px"}}),e.jsx("h6",{className:t==="dark"?"text-light":"text-dark",children:"Aucun projet"}),e.jsx("p",{className:t==="dark"?"text-light":"text-muted",children:"Vous n'êtes assigné à aucun projet pour le moment."}),e.jsx(n,{variant:"primary",as:c,to:"/employee/tasks",children:"Voir mes tâches"})]})})]})})]}),e.jsxs(u,{className:"mb-4",children:[e.jsx(l,{md:8,children:e.jsxs(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-center",children:[e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"clock",className:"me-2",style:{width:"20px",height:"20px"}}),"Tâches Récentes"]}),e.jsx(n,{variant:"outline-primary",size:"sm",as:c,to:"/employee/tasks",children:"Voir tout"})]})}),e.jsx(a.Body,{children:p.length>0?e.jsx("div",{className:"list-group list-group-flush",children:p.map(s=>e.jsx("div",{className:`list-group-item list-group-item-action border-0 ${t==="dark"?"bg-dark text-light":""}`,children:e.jsxs("div",{className:"d-flex justify-content-between align-items-start",children:[e.jsxs("div",{className:"flex-grow-1",children:[e.jsxs("div",{className:"d-flex align-items-center mb-1",children:[e.jsx("h6",{className:`mb-0 me-2 ${t==="dark"?"text-light":"text-dark"}`,children:s.title}),e.jsx(m,{bg:M(s.priority),className:"me-2",children:z(s.priority)}),e.jsx(m,{bg:V(s.status),children:H(s.status)}),U(s.due_date,s.status)&&e.jsxs(m,{bg:"danger",className:"ms-2",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-1",style:{width:"12px",height:"12px"}}),"En retard"]})]}),s.description&&e.jsx("p",{className:`mb-1 small ${t==="dark"?"text-light":"text-muted"}`,children:s.description.length>100?`${s.description.substring(0,100)}...`:s.description}),e.jsxs("div",{className:"small text-muted",children:[s.project_title&&e.jsxs("span",{className:"me-3",children:[e.jsx("i",{"data-feather":"folder",className:"me-1",style:{width:"12px",height:"12px"}}),s.project_title]}),s.due_date&&e.jsxs("span",{className:"me-3",children:[e.jsx("i",{"data-feather":"calendar",className:"me-1",style:{width:"12px",height:"12px"}}),w(s.due_date)]}),e.jsxs("span",{children:[e.jsx("i",{"data-feather":"clock",className:"me-1",style:{width:"12px",height:"12px"}}),w(s.created_at)]})]})]}),e.jsx("div",{className:"d-flex gap-1 ms-3",children:e.jsx(n,{size:"sm",variant:"outline-primary",as:c,to:`/employee/tasks/${s.id}`,title:"Voir les détails",children:e.jsx("i",{"data-feather":"eye",style:{width:"14px",height:"14px"}})})})]})},s.id))}):e.jsxs("div",{className:"text-center py-4",children:[e.jsx("i",{"data-feather":"check-circle",className:"text-muted mb-3",style:{width:"48px",height:"48px"}}),e.jsx("h6",{className:t==="dark"?"text-light":"text-dark",children:"Aucune tâche récente"}),e.jsx("p",{className:t==="dark"?"text-light":"text-muted",children:"Vous n'avez pas encore de tâches. Commencez par en créer une !"}),e.jsx(n,{variant:"primary",as:c,to:"/employee/tasks/create",children:"Créer ma première tâche"})]})})]})}),e.jsxs(l,{md:4,children:[e.jsxs(a,{className:`border-0 shadow-sm mb-4 ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"20px",height:"20px"}}),"Tâches par Priorité"]})}),e.jsx(a.Body,{children:e.jsx("div",{className:"text-center",children:e.jsxs("div",{className:"mb-3",children:[e.jsxs(m,{bg:"danger",className:"fs-6 px-3 py-2 mb-2 d-block",children:[e.jsx("i",{"data-feather":"alert-triangle",className:"me-2",style:{width:"16px",height:"16px"}}),"Haute: ",i?.by_priority?.high||0]}),e.jsxs(m,{bg:"warning",className:"fs-6 px-3 py-2 mb-2 d-block",children:[e.jsx("i",{"data-feather":"flag",className:"me-2",style:{width:"16px",height:"16px"}}),"Moyenne: ",i?.by_priority?.medium||0]}),e.jsxs(m,{bg:"success",className:"fs-6 px-3 py-2 d-block",children:[e.jsx("i",{"data-feather":"check",className:"me-2",style:{width:"16px",height:"16px"}}),"Basse: ",i?.by_priority?.low||0]})]})})})]}),e.jsxs(a,{className:`border-0 shadow-sm ${t==="dark"?"bg-dark":"bg-white"}`,children:[e.jsx(a.Header,{className:`border-0 ${t==="dark"?"bg-dark":"bg-white"}`,children:e.jsxs("h5",{className:"mb-0 d-flex align-items-center",children:[e.jsx("i",{"data-feather":"zap",className:"me-2 text-warning",style:{width:"20px",height:"20px"}}),"Actions Rapides"]})}),e.jsx(a.Body,{children:e.jsxs("div",{className:"d-grid gap-2",children:[e.jsxs(n,{variant:"primary",as:c,to:"/employee/tasks/create",children:[e.jsx("i",{"data-feather":"plus",className:"me-2",style:{width:"16px",height:"16px"}}),"Nouvelle Tâche"]}),e.jsxs(n,{variant:"outline-primary",as:c,to:"/employee/projects",children:[e.jsx("i",{"data-feather":"folder",className:"me-2",style:{width:"16px",height:"16px"}}),"Mes Projets"]}),e.jsxs(n,{variant:"outline-success",as:c,to:"/employee/tasks",children:[e.jsx("i",{"data-feather":"list",className:"me-2",style:{width:"16px",height:"16px"}}),"Toutes mes Tâches"]})]})})]})]})]})]})})}export{ae as default};
